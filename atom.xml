<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Duan</title>
  
  <subtitle>有点小菜</subtitle>
  <link href="http://duanyushuai.github.io/atom.xml" rel="self"/>
  
  <link href="http://duanyushuai.github.io/"/>
  <updated>2022-08-11T14:06:32.123Z</updated>
  <id>http://duanyushuai.github.io/</id>
  
  <author>
    <name>小段</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>接口幂等性</title>
    <link href="http://duanyushuai.github.io/2022/08/10/%E6%8E%A5%E5%8F%A3%E5%B9%82%E7%AD%89%E6%80%A7/"/>
    <id>http://duanyushuai.github.io/2022/08/10/%E6%8E%A5%E5%8F%A3%E5%B9%82%E7%AD%89%E6%80%A7/</id>
    <published>2022-08-10T02:00:00.000Z</published>
    <updated>2022-08-11T14:06:32.123Z</updated>
    
    <content type="html"><![CDATA[<h1 id="接口幂等性"><a href="#接口幂等性" class="headerlink" title="接口幂等性"></a>接口幂等性</h1><p>问题出现</p><ol><li>用户多次点击</li><li>用户回退在提交</li><li>feign触发重试</li></ol><h3 id="1-token"><a href="#1-token" class="headerlink" title="1.token"></a>1.token</h3><p> token 的获取、比较和删除必须是原子性的</p><p>使用redis和lua脚本</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&#x27;get&#x27;</span>,KEYS[<span class="number">1</span>]==ARGV[<span class="number">1</span>] <span class="keyword">then</span> <span class="keyword">return</span> is.call(<span class="string">&#x27;del&#x27;</span>,KEYS[<span class="number">1</span>])) <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="2-各种锁机制"><a href="#2-各种锁机制" class="headerlink" title="2. 各种锁机制"></a>2. 各种锁机制</h3><h4 id="1-数据库悲观锁"><a href="#1-数据库悲观锁" class="headerlink" title="1. 数据库悲观锁"></a>1. 数据库悲观锁</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from xxxx where id=1 for update</span><br></pre></td></tr></table></figure><p>id一定是主键和唯一索引，不然可能造成锁表</p><h4 id="2-数据库乐观锁"><a href="#2-数据库乐观锁" class="headerlink" title="2. 数据库乐观锁"></a>2. 数据库乐观锁</h4><p>首先获取这条数据的版本号version，然后操作的时候带上版本号</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update goods <span class="type">set</span> <span class="variable">count</span> <span class="operator">=</span> count -<span class="number">1</span> ,version = version + <span class="number">1</span> <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">2</span> <span class="type">and</span> <span class="variable">version</span> <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>乐观锁处理读多写少问题</p><h3 id="3-业务分布式锁"><a href="#3-业务分布式锁" class="headerlink" title="3. 业务分布式锁"></a>3. 业务分布式锁</h3><h3 id="4-各种唯一索引"><a href="#4-各种唯一索引" class="headerlink" title="4. 各种唯一索引"></a>4. 各种唯一索引</h3><h4 id="数据库的唯一约束"><a href="#数据库的唯一约束" class="headerlink" title="数据库的唯一约束"></a>数据库的唯一约束</h4><p>插入数据按照唯一索引，比如订单号，相同的订单号就不能重复插入。需要不是自增主键，代码生成全局唯一id。</p><p>在分库分表下，根据路由规则，要路由到同一张表，才能是唯一索引有意义。</p><h4 id="redis防重"><a href="#redis防重" class="headerlink" title="redis防重"></a>redis防重</h4><p>我们可以计算上传数据的MD5值，存到redis set，每次处理数据，去和redis进行匹配</p><h4 id="防重表"><a href="#防重表" class="headerlink" title="防重表"></a>防重表</h4><p>把orderNo作为去重表的唯一索引插入mysql，去重表和业务表处在同一数据库，处于同一事务，方便回滚</p><h3 id="5-全局请求唯一id"><a href="#5-全局请求唯一id" class="headerlink" title="5.全局请求唯一id"></a>5.全局请求唯一id</h3><p>调用接口生成唯一id，保存在redis的集合中。</p><p>可以使用nginx设置请求的唯一id</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header  X-Request-Id $request_id;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;接口幂等性&quot;&gt;&lt;a href=&quot;#接口幂等性&quot; class=&quot;headerlink&quot; title=&quot;接口幂等性&quot;&gt;&lt;/a&gt;接口幂等性&lt;/h1&gt;&lt;p&gt;问题出现&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用户多次点击&lt;/li&gt;
&lt;li&gt;用户回退在提交&lt;/li&gt;
&lt;li&gt;feign触发</summary>
      
    
    
    
    <category term="java web" scheme="http://duanyushuai.github.io/categories/java-web/"/>
    
    
    <category term="java web" scheme="http://duanyushuai.github.io/tags/java-web/"/>
    
  </entry>
  
  <entry>
    <title>白嫖</title>
    <link href="http://duanyushuai.github.io/2022/07/29/%E7%99%BD%E5%AB%96/"/>
    <id>http://duanyushuai.github.io/2022/07/29/%E7%99%BD%E5%AB%96/</id>
    <published>2022-07-29T06:11:08.153Z</published>
    <updated>2022-08-11T14:06:17.307Z</updated>
    
    <content type="html"><![CDATA[<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><p>你有没有想过，在自己常用的网站地址前加几个字符，就可以实现各种各样的效果？</p><p>无需安装任何软件，就能解析视频、下载音乐、复制文库……是的你没看错，只需要简单地添加一个前缀，就能解决。</p><ul><li><strong>视频解析</strong></li></ul><p>找到你喜欢的电影&#x2F;电视剧，打开它所在当前网页。</p><p>不论是爱奇艺，腾讯视频还是其他视频网站，只需要在网站前加上wn.run&#x2F;这串字符。</p><p>注意：一定要在http或https前面添加。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Oy6E1oydbSibAbcDz4HSHsUGMk8iczLnSWqjMCHy81nYbMico1WQ8dXehfPLGJeeWc7icRxeHLEE78uULa114aOE9g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p><p>然后按下回车，就会跳转至一个名为万能命令的新页面。</p><p>在下方【相关视频播放】这一栏里，就是你想观看的视频的解析结果。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Oy6E1oydbSibAbcDz4HSHsUGMk8iczLnSWMMXbNNVkx1ts1Siasricg9hEUt0CWItXVAvdUzRJib4k90E5JP4wxfOhw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p><p>任选一个解析网站打开，就可以全屏观看该视频了。</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><ul><li><strong>文库下载</strong></li></ul><p>对于工作党和学生党来说，最痛苦的事情，莫过于找到了急需的资料，却没有文库VIP了。</p><p>在某度文库上，如果没有开通VIP的话，既无法复制文字，也无法下载文档，几乎是寸步难行。</p><p>这时候，我们只需要在所需文档地址前加上wn.run&#x2F;前缀。</p><p>按下回车，就可以找到文库在线下载的解析结果了。</p><p>点击上述结果，即会自动跳转至一个名为网页转换助手的页面。</p><p>在这里，你可以选择【转为Word】或【转为PDF】。</p><p>然后点击【下载】按钮，就能成功下载该会员文档的源文件了。</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><ul><li><strong>音乐下载</strong></li></ul><p>如果想要下载网易云音乐、QQ音乐、酷狗音乐上的歌曲，只需在播放地址前加上wn.run&#x2F;。</p><p>然后选择其中一个解析源，就能下载歌曲了。</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><ul><li><strong>视频下载</strong></li></ul><p>当然，这个小技巧不仅能用于下载音乐，同时也可以用来下载各个视频网站上的视频。</p><p>以B站为例，在网址前输入wn.run&#x2F;。</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p>然后回车，选择其中一个解析结果，就可以成功下载该视频了。</p><p>除了上面介绍的功能，通过wn.run&#x2F;这个命令还能实现许许多多的效果，比如网页翻译、网页截图、网页二维码生成等等。</p><p>每个功能都无需下载、即用即走，且没有平台限制，pc、android、ios等都可使用。</p><p>另外，在万能命令网站里，还收录了很多高质量的工具，大家感兴趣的话，也可以直接收藏这个地址。</p><p>鉴于这个工具比较敏感，如果大家有需要的话，就赶紧试试吧！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;工具&quot;&gt;&lt;a href=&quot;#工具&quot; class=&quot;headerlink&quot; title=&quot;工具&quot;&gt;&lt;/a&gt;工具&lt;/h1&gt;&lt;p&gt;你有没有想过，在自己常用的网站地址前加几个字符，就可以实现各种各样的效果？&lt;/p&gt;
&lt;p&gt;无需安装任何软件，就能解析视频、下载音乐、复制文库</summary>
      
    
    
    
    <category term="工具" scheme="http://duanyushuai.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="工具" scheme="http://duanyushuai.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://duanyushuai.github.io/2022/07/29/rabbitMQ/"/>
    <id>http://duanyushuai.github.io/2022/07/29/rabbitMQ/</id>
    <published>2022-07-29T02:50:51.349Z</published>
    <updated>2022-07-29T09:31:45.704Z</updated>
    
    <content type="html"><![CDATA[<h1 id="rabbitMQ"><a href="#rabbitMQ" class="headerlink" title="rabbitMQ"></a>rabbitMQ</h1><p><img src="/../img/rabbitMQ1.jpeg" alt="image-20220729112858465"></p><p><img src="/../img/rabbitMQ3.png" alt="image-20220729113148829"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;rabbitMQ&quot;&gt;&lt;a href=&quot;#rabbitMQ&quot; class=&quot;headerlink&quot; title=&quot;rabbitMQ&quot;&gt;&lt;/a&gt;rabbitMQ&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/../img/rabbitMQ1.jpeg&quot; alt=&quot;image-2</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>redis 缓存</title>
    <link href="http://duanyushuai.github.io/2022/07/11/redis%20%E7%BC%93%E5%AD%98/"/>
    <id>http://duanyushuai.github.io/2022/07/11/redis%20%E7%BC%93%E5%AD%98/</id>
    <published>2022-07-11T13:46:55.260Z</published>
    <updated>2022-07-12T13:52:10.751Z</updated>
    
    <content type="html"><![CDATA[<h1 id="redis-缓存"><a href="#redis-缓存" class="headerlink" title="redis 缓存"></a>redis 缓存</h1><h4 id="那些数据适合缓存"><a href="#那些数据适合缓存" class="headerlink" title="那些数据适合缓存"></a>那些数据适合缓存</h4><ol><li><p>即时性和数据一致性要求不高的</p></li><li><p>读多写少</p></li></ol><p>使用redis</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line"> &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>简单的分布式锁</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;Catelog2Vo&gt;&gt; <span class="title function_">getCatalogJsonFromDbWithRedislock</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 占分布式锁，去redis占坑</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">lock</span> <span class="operator">=</span> redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;lock&quot;</span>, uuid, <span class="number">300</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">if</span> (lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;获取分布式锁成功&quot;</span>);</span><br><span class="line">            <span class="comment">// 加锁成功...执行业务</span></span><br><span class="line">            <span class="comment">// 2 设置过期时间</span></span><br><span class="line"><span class="comment">//            redisTemplate.expire(&quot;lock&quot;, 30, TimeUnit.SECONDS);</span></span><br><span class="line">            Map&lt;String, List&lt;Catelog2Vo&gt;&gt; dataFromDB;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                dataFromDB = getDataFromDB();</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line">                <span class="comment">// 删除锁</span></span><br><span class="line">                <span class="type">Long</span> <span class="variable">lock1</span> <span class="operator">=</span> redisTemplate.execute(<span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;Long&gt;(script, Long.class), Arrays.asList(<span class="string">&quot;lock&quot;</span>), uuid);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            redisTemplate.delete(&quot;lock&quot;);</span></span><br><span class="line">            <span class="comment">// 获取值对比 + 对比成功删除 = 原子操作  lua脚本解锁</span></span><br><span class="line"><span class="comment">//            String lockValue = redisTemplate.opsForValue().get(&quot;lock&quot;);</span></span><br><span class="line"><span class="comment">//            if (uuid.equals(lockValue)) &#123;</span></span><br><span class="line"><span class="comment">//                // 删除我自己的锁</span></span><br><span class="line"><span class="comment">//                redisTemplate.delete(&quot;lock&quot;);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> dataFromDB;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 加锁失败</span></span><br><span class="line">            <span class="comment">// 休眠100ms重试</span></span><br><span class="line">            System.out.println(<span class="string">&quot;获取分布式锁失败...等待重试&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> getCatalogJsonFromDbWithRedislock(); <span class="comment">// 自旋的方式</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;redis-缓存&quot;&gt;&lt;a href=&quot;#redis-缓存&quot; class=&quot;headerlink&quot; title=&quot;redis 缓存&quot;&gt;&lt;/a&gt;redis 缓存&lt;/h1&gt;&lt;h4 id=&quot;那些数据适合缓存&quot;&gt;&lt;a href=&quot;#那些数据适合缓存&quot; class=&quot;head</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>nginx使用</title>
    <link href="http://duanyushuai.github.io/2022/07/02/nginx%E4%BD%BF%E7%94%A8/"/>
    <id>http://duanyushuai.github.io/2022/07/02/nginx%E4%BD%BF%E7%94%A8/</id>
    <published>2022-07-02T10:30:26.308Z</published>
    <updated>2022-07-02T10:34:50.961Z</updated>
    
    <content type="html"><![CDATA[<h1 id="nginx使用"><a href="#nginx使用" class="headerlink" title="nginx使用"></a>nginx使用</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;nginx使用&quot;&gt;&lt;a href=&quot;#nginx使用&quot; class=&quot;headerlink&quot; title=&quot;nginx使用&quot;&gt;&lt;/a&gt;nginx使用&lt;/h1&gt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>sku和spu数据库设计</title>
    <link href="http://duanyushuai.github.io/2022/06/26/sku%E5%92%8Cspu%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/"/>
    <id>http://duanyushuai.github.io/2022/06/26/sku%E5%92%8Cspu%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/</id>
    <published>2022-06-26T10:50:48.206Z</published>
    <updated>2022-07-03T02:56:31.206Z</updated>
    
    <content type="html"><![CDATA[<h2 id="sku和spu数据库设计"><a href="#sku和spu数据库设计" class="headerlink" title="sku和spu数据库设计"></a>sku和spu数据库设计</h2><p><img src="/../img/skuspu1.png"></p><p><img src="/../img/skuspu2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;sku和spu数据库设计&quot;&gt;&lt;a href=&quot;#sku和spu数据库设计&quot; class=&quot;headerlink&quot; title=&quot;sku和spu数据库设计&quot;&gt;&lt;/a&gt;sku和spu数据库设计&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/../img/skuspu1.png&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>自定义注解</title>
    <link href="http://duanyushuai.github.io/2022/06/26/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%88%E6%A0%A1%E9%AA%8C%E5%92%8C%E6%97%A5%E5%BF%97%EF%BC%89/"/>
    <id>http://duanyushuai.github.io/2022/06/26/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%88%E6%A0%A1%E9%AA%8C%E5%92%8C%E6%97%A5%E5%BF%97%EF%BC%89/</id>
    <published>2022-06-26T03:34:51.020Z</published>
    <updated>2022-07-02T07:51:02.580Z</updated>
    
    <content type="html"><![CDATA[<h2 id="自定义注解（校验和日志）"><a href="#自定义注解（校验和日志）" class="headerlink" title="自定义注解（校验和日志）"></a>自定义注解（校验和日志）</h2><h2 id="JSR303-自定义校验"><a href="#JSR303-自定义校验" class="headerlink" title="JSR303 自定义校验"></a>JSR303 自定义校验</h2><h4 id="创建ListValue校验注解"><a href="#创建ListValue校验注解" class="headerlink" title="创建ListValue校验注解"></a>创建ListValue校验注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yxj.gulimall.common.valid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.Constraint;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Payload;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 自定义校验注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint(</span></span><br><span class="line"><span class="meta">        validatedBy = &#123;ListValueConstraintValidator.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ListValue &#123;</span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&#123;com.chenxin.gulimail.common.valid.ListValue.message&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[] vals() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ListValueConstraintValidator校验器"><a href="#ListValueConstraintValidator校验器" class="headerlink" title="ListValueConstraintValidator校验器"></a>ListValueConstraintValidator校验器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    Set&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Integer&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> constraintAnnotation</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ListValue constraintAnnotation)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] vals = constraintAnnotation.vals();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> val : vals) &#123;</span><br><span class="line">            set.add(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 真正的校验规则</span></span><br><span class="line"><span class="comment">     * 判断是否校验成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> constraintValidatorContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(Integer integer, ConstraintValidatorContext constraintValidatorContext)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> set.contains(integer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;自定义注解（校验和日志）&quot;&gt;&lt;a href=&quot;#自定义注解（校验和日志）&quot; class=&quot;headerlink&quot; title=&quot;自定义注解（校验和日志）&quot;&gt;&lt;/a&gt;自定义注解（校验和日志）&lt;/h2&gt;&lt;h2 id=&quot;JSR303-自定义校验&quot;&gt;&lt;a href=&quot;#J</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>redis Guava 缓存</title>
    <link href="http://duanyushuai.github.io/2022/06/26/redis-Guava-%E7%BC%93%E5%AD%98/"/>
    <id>http://duanyushuai.github.io/2022/06/26/redis-Guava-%E7%BC%93%E5%AD%98/</id>
    <published>2022-06-26T02:00:00.000Z</published>
    <updated>2022-07-24T13:18:01.257Z</updated>
    
    <content type="html"><![CDATA[<h2 id="redis-Guava-缓存"><a href="#redis-Guava-缓存" class="headerlink" title="redis Guava 缓存"></a>redis Guava 缓存</h2><h3 id="redis-懒加载"><a href="#redis-懒加载" class="headerlink" title="redis 懒加载"></a>redis 懒加载</h3><p>数据在新增到 MySQL 不进行缓存，在精确查找进行缓存，做到查询即缓存，不查询不缓存。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 伪代码示例 Xx代表你的的业务对象 如User Goods等等</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XxLazyCache</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Xx&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> XxService xxService;<span class="comment">// 你的业务service</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询 通过查询缓存是否存在驱动缓存加载 建议在前置业务保证id对应数据是绝对存在于数据库中的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Xx <span class="title function_">getXx</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询缓存里面有没有数据</span></span><br><span class="line">        <span class="type">Xx</span> <span class="variable">xxCache</span> <span class="operator">=</span> getXxFromCache(id);</span><br><span class="line">        <span class="keyword">if</span>(xxCache != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> xxCache;<span class="comment">// 卫语句使代码更有利于阅读</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.查询数据库获取数据 我们假定到业务这一步，传过来的id都在数据库中有对应数据</span></span><br><span class="line">        <span class="type">Xx</span> <span class="variable">xx</span> <span class="operator">=</span> xxService.getXxById(id);</span><br><span class="line">        <span class="comment">// 3.设置缓存、这一步相当于Redis缓存懒加载，下次再查询此id，则会走缓存</span></span><br><span class="line">        setXxFromCache(xx);</span><br><span class="line">        <span class="keyword">return</span> xx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对xx数据进行修改或者删除操作 操作数据库成功后 删除缓存</span></span><br><span class="line"><span class="comment">     * 删除请求 - 删除数据库数据 删除缓存</span></span><br><span class="line"><span class="comment">     * 修改请求 - 更新数据库数据 删除缓存 下次在查询时候就会从数据库拉取新的数据到缓存中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteXxFromCache</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;Xx:&quot;</span> + xx.getId();</span><br><span class="line">        redisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setXxFromCache</span><span class="params">(Xx xx)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;Xx:&quot;</span> + xx.getId();</span><br><span class="line">        redisTemplate.opsForValue().set(key, xx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Xx <span class="title function_">getXxFromCache</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过缓存前缀拼装唯一主键作为缓存Key 如Xxx信息 就是Xxx:id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;Xx:&quot;</span> + id;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 业务类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XxServie</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> XxLazyCache xxLazyCache;</span><br><span class="line">    <span class="comment">// 查询数据库</span></span><br><span class="line">    <span class="keyword">public</span> Xx <span class="title function_">getXxById</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="comment">// 省略实现</span></span><br><span class="line">        <span class="keyword">return</span> xx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateXx</span><span class="params">(Xx xx)</span> &#123;</span><br><span class="line">        <span class="comment">// 更新MySQL数据 省略</span></span><br><span class="line">        <span class="comment">// 删除缓存</span></span><br><span class="line">        xxLazyCache.deleteXxFromCache(xx.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteXx</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="comment">// 删除MySQL数据 省略</span></span><br><span class="line">        <span class="comment">// 删除缓存</span></span><br><span class="line">        xxLazyCache.deleteXxFromCache(xx.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Xx</span> &#123;</span><br><span class="line">    <span class="comment">// 业务主键</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;redis-Guava-缓存&quot;&gt;&lt;a href=&quot;#redis-Guava-缓存&quot; class=&quot;headerlink&quot; title=&quot;redis Guava 缓存&quot;&gt;&lt;/a&gt;redis Guava 缓存&lt;/h2&gt;&lt;h3 id=&quot;redis-懒加载&quot;&gt;&lt;a hre</summary>
      
    
    
    
    <category term="Guava" scheme="http://duanyushuai.github.io/categories/Guava/"/>
    
    <category term="redis" scheme="http://duanyushuai.github.io/categories/Guava/redis/"/>
    
    
    <category term="Guava" scheme="http://duanyushuai.github.io/tags/Guava/"/>
    
    <category term="redis" scheme="http://duanyushuai.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>解决跨域</title>
    <link href="http://duanyushuai.github.io/2022/06/25/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F/"/>
    <id>http://duanyushuai.github.io/2022/06/25/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F/</id>
    <published>2022-06-25T09:57:38.465Z</published>
    <updated>2022-07-02T09:48:55.861Z</updated>
    
    <content type="html"><![CDATA[<h2 id="解决跨域"><a href="#解决跨域" class="headerlink" title="解决跨域"></a>解决跨域</h2><ol><li>使用nginx部署为同一域</li></ol><p><img src="/../img/kuayu1.png" alt=" "></p><ol start="2"><li>请求返回可跨域</li></ol><p><img src="/../img/kuayu2.png">   </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;解决跨域&quot;&gt;&lt;a href=&quot;#解决跨域&quot; class=&quot;headerlink&quot; title=&quot;解决跨域&quot;&gt;&lt;/a&gt;解决跨域&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;使用nginx部署为同一域&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;/../img/kuayu1.png</summary>
      
    
    
    
    <category term="跨域" scheme="http://duanyushuai.github.io/categories/%E8%B7%A8%E5%9F%9F/"/>
    
    
    <category term="跨域" scheme="http://duanyushuai.github.io/tags/%E8%B7%A8%E5%9F%9F/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://duanyushuai.github.io/2022/06/12/Duan/"/>
    <id>http://duanyushuai.github.io/2022/06/12/Duan/</id>
    <published>2022-06-12T09:02:04.255Z</published>
    <updated>2022-06-13T00:32:33.427Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Duan"><a href="#Duan" class="headerlink" title="Duan"></a>Duan</h2><p>test</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Duan&quot;&gt;&lt;a href=&quot;#Duan&quot; class=&quot;headerlink&quot; title=&quot;Duan&quot;&gt;&lt;/a&gt;Duan&lt;/h2&gt;&lt;p&gt;test&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>docker入门</title>
    <link href="http://duanyushuai.github.io/2022/03/02/docker/"/>
    <id>http://duanyushuai.github.io/2022/03/02/docker/</id>
    <published>2022-03-02T02:00:00.000Z</published>
    <updated>2022-06-21T02:24:27.154Z</updated>
    
    <content type="html"><![CDATA[<h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1. 卸载系统之前的docker </span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br><span class="line">2.$ sudo yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br><span class="line"></span><br><span class="line">3. sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">4. 安装DOCKER引擎</span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line">5. 启动Docker.</span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line">6. 设置开机自启</span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line">7. 阿里云镜像加速器</span><br><span class="line">https://cr.console.aliyun.com/cn-wulanchabu/instances/mirrors</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="docker-使用"><a href="#docker-使用" class="headerlink" title="docker 使用"></a>docker 使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull mysql:8.0</span><br><span class="line"></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">创建目录保存数据</span><br><span class="line">sudo docker run --name mysql -v /usr/local/mysql/data:/var/lib/mysql -v /usr/local/mysql:/etc/mysql/conf.d -v /usr/local/mysql/log:/var/log/mysql  -e MYSQL_ROOT_PASSWORD=root  -p 3306:3306 -d mysql:8.0</span><br><span class="line"></span><br><span class="line"><span class="comment">## -v 目录映射，可以在linux环境中寻找文件，修改容器配置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看运行容器</span><br><span class="line">docker ps</span><br><span class="line">[root@hecs-328722 mysql]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                                                  NAMES</span><br><span class="line">369ccdfb7630   mysql:8.0   <span class="string">&quot;docker-entrypoint.s…&quot;</span>   6 minutes ago   Up 6 minutes   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   mysql</span><br><span class="line"></span><br><span class="line">进入容器 内部</span><br><span class="line">docker <span class="built_in">exec</span> -it 容器名称|容器<span class="built_in">id</span> bin/bash</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -it mysql bin/bash</span><br><span class="line"></span><br><span class="line">退出容器</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">1. 安装redis</span><br><span class="line">docker pull redis:6.0.10</span><br><span class="line"></span><br><span class="line">2. 修改需要自定义的配置(docker-redis默认没有配置文件，</span><br><span class="line">自己在宿主机建立后挂载映射)</span><br><span class="line">创建并修改/usr/local/redis/redis.conf</span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0 开启远程权限</span><br><span class="line">appendonly <span class="built_in">yes</span> 开启aof持久化</span><br><span class="line"></span><br><span class="line">3.</span><br><span class="line">docker run --name redis  -v /usr/local/redis/data:/data  -v /usr/local/redis/redis.conf:/usr/local/etc/redis/redis.conf -p 6379:6379 -d redis:6.0.10  redis-server /usr/local/etc/redis/redis.conf </span><br><span class="line"></span><br><span class="line">解释： -v /usr/local/redis/data:/data  <span class="comment"># 将数据目录挂在到本地保证数据安全</span></span><br><span class="line"> -v /root/redis/redis.conf:/usr/local/etc/redis/redis.conf   <span class="comment"># 将配置文件挂在到本地修改方便</span></span><br><span class="line"> </span><br><span class="line"> 4. docker 起客户端</span><br><span class="line"> docker <span class="built_in">exec</span> -it redis redis-cli</span><br><span class="line"></span><br><span class="line"> 5. 重启redis</span><br><span class="line"> docker restart redis</span><br><span class="line"> </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;docker&quot;&gt;&lt;a href=&quot;#docker&quot; class=&quot;headerlink&quot; title=&quot;docker&quot;&gt;&lt;/a&gt;docker&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutt</summary>
      
    
    
    
    <category term="docker" scheme="http://duanyushuai.github.io/categories/docker/"/>
    
    <category term="谷粒商城" scheme="http://duanyushuai.github.io/categories/docker/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/"/>
    
    
    <category term="docker" scheme="http://duanyushuai.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>全局异常</title>
    <link href="http://duanyushuai.github.io/2021/10/11/%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8/"/>
    <id>http://duanyushuai.github.io/2021/10/11/%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8/</id>
    <published>2021-10-11T02:00:00.000Z</published>
    <updated>2022-07-02T07:51:27.539Z</updated>
    
    <content type="html"><![CDATA[<h2 id="全局异常"><a href="#全局异常" class="headerlink" title="全局异常"></a>全局异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice(basePackages = &quot;com.yxj.gulimall.product.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GulimallExceptionControllerAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleValidException</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;数据校验出现问题&#123;&#125;,异常类型: &#123;&#125;&quot;</span>,e.getMessage(),e.getClass());</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> e.getBindingResult();</span><br><span class="line">        Map&lt;String, String&gt; errorMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        bindingResult.getFieldErrors().forEach((fieldError -&gt; &#123;</span><br><span class="line">            errorMap.put(fieldError.getField(),fieldError.getDefaultMessage());</span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.VALID_EXCEPTION.getCode(),BizCodeEnum.VALID_EXCEPTION.getMsg()).put(<span class="string">&quot;data&quot;</span>,errorMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Throwable.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleException</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;错误:&quot;</span>, throwable);</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.UNKNOWN_EXCEPTION.getCode(),BizCodeEnum.UNKNOWN_EXCEPTION.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;全局异常&quot;&gt;&lt;a href=&quot;#全局异常&quot; class=&quot;headerlink&quot; title=&quot;全局异常&quot;&gt;&lt;/a&gt;全局异常&lt;/h2&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>HashMap</title>
    <link href="http://duanyushuai.github.io/2021/07/08/HashMap/"/>
    <id>http://duanyushuai.github.io/2021/07/08/HashMap/</id>
    <published>2021-07-08T03:00:23.000Z</published>
    <updated>2022-06-18T07:38:31.348Z</updated>
    
    <content type="html"><![CDATA[<h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p>jdk1.7  数组+链表</p><p>jdk1.8 数组+ 链表&#x2F;红黑树</p><ul><li><code>DEFAULT_INITIAL_CAPACITY</code> Table数组的初始化长度： <code>1 &lt;&lt; 4``2^4=16</code>（为什么要是 2的n次方？）</li><li><code>MAXIMUM_CAPACITY</code> Table数组的最大长度： <code>1&lt;&lt;30``2^30=1073741824</code></li><li><code>DEFAULT_LOAD_FACTOR</code> 负载因子：默认值为<code>0.75</code>。 当元素的总个数&gt;当前数组的长度 * 负载因子。数组会进行扩容，扩容为原来的两倍（todo：为什么是两倍？）</li><li><code>TREEIFY_THRESHOLD</code> 链表树化阙值： 默认值为 <code>8</code> 。表示在一个node（Table）节点下的值的个数大于8时候，会将链表转换成为红黑树。</li><li><code>UNTREEIFY_THRESHOLD</code> 红黑树链化阙值： 默认值为 <code>6</code> 。 表示在进行扩容期间，单个Node节点下的红黑树节点的个数小于6时候，会将红黑树转化成为链表。</li><li><code>MIN_TREEIFY_CAPACITY = 64</code> 最小树化阈值，当Table所有元素超过改值，才会进行树化（为了防止前期阶段频繁扩容和树化过程冲突）</li></ul><p>HashMap是线程不安全的</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;HashMap&quot;&gt;&lt;a href=&quot;#HashMap&quot; class=&quot;headerlink&quot; title=&quot;HashMap&quot;&gt;&lt;/a&gt;HashMap&lt;/h2&gt;&lt;p&gt;jdk1.7  数组+链表&lt;/p&gt;
&lt;p&gt;jdk1.8 数组+ 链表&amp;#x2F;红黑树&lt;/p&gt;
&lt;u</summary>
      
    
    
    
    <category term="java" scheme="http://duanyushuai.github.io/categories/java/"/>
    
    
    <category term="java" scheme="http://duanyushuai.github.io/tags/java/"/>
    
    <category term="HashMap" scheme="http://duanyushuai.github.io/tags/HashMap/"/>
    
  </entry>
  
  <entry>
    <title>Java高并发程序设计第二章</title>
    <link href="http://duanyushuai.github.io/2021/06/07/Java%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E4%BA%8C%E7%AB%A0/"/>
    <id>http://duanyushuai.github.io/2021/06/07/Java%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E4%BA%8C%E7%AB%A0/</id>
    <published>2021-06-07T03:00:23.000Z</published>
    <updated>2022-06-13T15:00:55.975Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java高并发程序设计第二章"><a href="#Java高并发程序设计第二章" class="headerlink" title="Java高并发程序设计第二章"></a>Java高并发程序设计第二章</h1><h4 id="线程创建4个方法"><a href="#线程创建4个方法" class="headerlink" title="线程创建4个方法"></a>线程创建4个方法</h4><p>创建线程4个方法</p><ol><li>继承Thread类创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;<span class="comment">//继承Thread类</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">　　<span class="comment">//重写run方法</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">MyThread</span>().start();<span class="comment">//创建并启动线程</span></span><br></pre></td></tr></table></figure><ol start="2"><li>实现Runnable接口创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;<span class="comment">//实现Runnable接口</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">　　<span class="comment">//重写run方法</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">　　　　<span class="comment">//创建并启动线程</span></span><br><span class="line">　　　　MyThread2 myThread=<span class="keyword">new</span> <span class="title class_">MyThread2</span>();</span><br><span class="line">　　　　Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(myThread);</span><br><span class="line">　　　　thread().start();</span><br><span class="line"></span><br><span class="line">　　　　<span class="comment">//或者    new Thread(new MyThread2()).start();</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>使用Callable和Future创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">// 先使用Lambda表达式创建Callable&lt;Integer&gt;对象</span></span><br><span class="line">       <span class="comment">// 使用FutureTask来包装Callable对象</span></span><br><span class="line">       FutureTask&lt;Integer&gt; task = <span class="keyword">new</span>  <span class="title class_">FutureTask</span>&lt;&gt;((Callable&lt;Integer&gt;)() -&gt; <span class="number">5</span>);</span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">Thread</span>(task).start();</span><br><span class="line">       <span class="keyword">try</span></span><br><span class="line">       &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;子线程的返回值：&quot;</span> +  task.get());</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">       &#123;</span><br><span class="line">           ex.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>使用线程池例如用Executor框架</li></ol><h4 id="线程中断"><a href="#线程中断" class="headerlink" title="线程中断"></a>线程中断</h4><hr><p>禁止用stop()来退出线程，不安全。</p><p>线程安全退出，与中断有关的三个方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> Thread.interrupt() <span class="comment">// 中断线程</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> Thread.isInterrupted() <span class="comment">// 判断是否被中断</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> Thread.interrupted() <span class="comment">// 判断是否被中断，并清除当前中断状态</span></span><br></pre></td></tr></table></figure><h4 id="等待wait和通知notify"><a href="#等待wait和通知notify" class="headerlink" title="等待wait和通知notify"></a>等待wait和通知notify</h4><hr><p>这两个⽅法并不是在Thread类中 的，⽽是输出Object类。</p><p>Object.wait()和Thread.sleep()方法都可以让线程等待若干时 间。除了wait()可以被唤醒外，另外一个主要区别就是wait()方法会 释放目标对象的锁，而Thread.sleep()方法不会释放任何资源。</p><h4 id="等待线程结束（join-和谦让-yield"><a href="#等待线程结束（join-和谦让-yield" class="headerlink" title="等待线程结束（join)和谦让(yield)"></a>等待线程结束（join)和谦让(yield)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JoinMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AddThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">1111111</span>;i++);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span></span><br><span class="line">            InterruptedException &#123;</span><br><span class="line">        AddThread at=<span class="keyword">new</span> <span class="title class_">AddThread</span>();</span><br><span class="line">        at.start();</span><br><span class="line">        at.join();</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>join()d的核心代码段</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line"> wait(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>可以看到，它让调⽤线程在当前线程对象上进⾏等待。当线程执 ⾏完成后，被等待的线程会在退出前调⽤notifyAll()通知所有的等待线 程继续执⾏。因此，值得注意的⼀点是：不要在应⽤程序中，在 Thread对象实例上使⽤类似wait()或者notify()等⽅法，因为这很有可能 会影响系统API的⼯作，或者被系统API所影响。</p></blockquote></blockquote><h4 id="守护线程-Daemon"><a href="#守护线程-Daemon" class="headerlink" title="守护线程(Daemon)"></a>守护线程(Daemon)</h4><p>如垃圾回收线程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> testdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaemonDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(DaemonDemo.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DaemonT</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">                logger.info(<span class="string">&quot;I am alive&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DaemonT</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DaemonT</span>();</span><br><span class="line">        d.setDaemon(<span class="literal">true</span>);</span><br><span class="line">        d.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>d线程为main线程的守护线程，main一结束，d立即结束。</p><h4 id="线程优先级设置"><a href="#线程优先级设置" class="headerlink" title="线程优先级设置"></a>线程优先级设置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread high=<span class="keyword">new</span> <span class="title class_">HightPriority</span>();</span><br><span class="line">LowPriority low=<span class="keyword">new</span> <span class="title class_">LowPriority</span>();</span><br><span class="line">high.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">low.setPriority(Thread.MIN_PRIORITY);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Java高并发程序设计第二章&quot;&gt;&lt;a href=&quot;#Java高并发程序设计第二章&quot; class=&quot;headerlink&quot; title=&quot;Java高并发程序设计第二章&quot;&gt;&lt;/a&gt;Java高并发程序设计第二章&lt;/h1&gt;&lt;h4 id=&quot;线程创建4个方法&quot;&gt;&lt;a href</summary>
      
    
    
    
    <category term="java" scheme="http://duanyushuai.github.io/categories/java/"/>
    
    
    <category term="java" scheme="http://duanyushuai.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>joda-time、日志、代码规范</title>
    <link href="http://duanyushuai.github.io/2021/04/07/joda-time%20%20%E6%97%A5%E5%BF%97%20%20%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/"/>
    <id>http://duanyushuai.github.io/2021/04/07/joda-time%20%20%E6%97%A5%E5%BF%97%20%20%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/</id>
    <published>2021-04-07T03:00:23.000Z</published>
    <updated>2022-06-13T15:02:06.174Z</updated>
    
    <content type="html"><![CDATA[<h4 id="joda-time-日志-代码规范"><a href="#joda-time-日志-代码规范" class="headerlink" title="joda-time  日志  代码规范"></a>joda-time  日志  代码规范</h4><h5 id="jode-time"><a href="#jode-time" class="headerlink" title="jode-time"></a>jode-time</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dateDemo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">dt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>(<span class="number">2015</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">12</span>,<span class="number">30</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">d</span> <span class="operator">=</span> dt.toDate();</span><br><span class="line">        <span class="comment">//当天起始日期</span></span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">today</span> <span class="operator">=</span> DateTime.now().withTimeAtStartOfDay();</span><br><span class="line">        <span class="comment">//三天后的日期</span></span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">dateTime</span> <span class="operator">=</span> today.plusDays(<span class="number">3</span>).plusMonths(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//入住时间和离店时间的差值</span></span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">checkIn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>(<span class="number">2015</span>,<span class="number">8</span>,<span class="number">29</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">checkOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>(<span class="number">2015</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        System.out.println(Days.daysBetween(checkIn,checkOut).getDays());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>日期格式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateTimeExample1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">DATE_TIME_FORMATTER</span> <span class="operator">=</span> DateTimeFormat.forPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(DATE_TIME_FORMATTER.print(<span class="keyword">new</span> <span class="title class_">DateTime</span>()));</span><br><span class="line">        System.out.println(DATE_TIME_FORMATTER.parseDateTime(<span class="string">&quot;2000-01-01 12:12:12&quot;</span>).toDate());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="日志规范"><a href="#日志规范" class="headerlink" title="日志规范"></a>日志规范</h5><p>配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.7</span><span class="number">.25</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.1</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.1</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>实例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LogTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;log in trace level,args:&#123;&#125;&quot;</span>,args);</span><br><span class="line">        logger.debug(<span class="string">&quot;log in trace level,args:&#123;&#125;&quot;</span>,args);</span><br><span class="line">        logger.info(<span class="string">&quot;log in trace level,args:&#123;&#125;&quot;</span>,args);</span><br><span class="line">        logger.warn(<span class="string">&quot;log in trace level,args:&#123;&#125;&quot;</span>,args);</span><br><span class="line">        logger.error(<span class="string">&quot;log in trace level,args:&#123;&#125;&quot;</span>,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>查看日志</strong></p><ol><li>登录跳板机</li><li>在跳板机登录服务器</li><li>进入应用目录，一般为&#x2F;home&#x2F;q&#x2F;www&#x2F;&lt;应用名&gt;&#x2F;</li><li>该目录下有logs目录，其中存放了Tomcat日志，catalina.out记录了打印到控制台的日志，一般来说，查看改日志即可。</li></ol><p><strong>日志规范</strong></p><ul><li><p>禁止使用System.out.print()</p></li><li><p>在异常处理中打印关键信息</p><ul><li>入参</li><li>关键变量值</li></ul></li><li><p>注意数据保密</p><ul><li>与用户相关的信息保密</li><li>打码到日志</li></ul></li><li><p>不能影响正常业务</p><ul><li>打印日志不能抛出异常，不能影响正常业务</li><li>日志影响性能，高QPS业务，控制日志输出量。</li></ul></li><li><p>使用占位符代替字符串拼接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LogTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;111&quot;</span>;</span><br><span class="line">        logger.info(<span class="string">&quot;log in trace level,args: &#123;&#125;&quot;</span>,args);</span><br><span class="line">        logger.info(<span class="string">&quot;log in trace level,args: &#123;&#125; , &#123;&#125;&quot;</span>,s,s.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>代码规范</strong></p><ul><li>代码给以后的自己看</li><li>强迫症</li></ul><p>书《编写可读代码的艺术》</p><ul><li>类名：形容词或动词</li><li>方法名：动词</li></ul><p><strong>注释</strong></p><ul><li>使用Javadoc格式编写注释</li><li>接口必须有注释，对参数，返回值有说明。例如参数限制，返回值是否为空，接口调用频率。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;joda-time-日志-代码规范&quot;&gt;&lt;a href=&quot;#joda-time-日志-代码规范&quot; class=&quot;headerlink&quot; title=&quot;joda-time  日志  代码规范&quot;&gt;&lt;/a&gt;joda-time  日志  代码规范&lt;/h4&gt;&lt;h5 id=&quot;j</summary>
      
    
    
    
    <category term="java" scheme="http://duanyushuai.github.io/categories/java/"/>
    
    
    <category term="java" scheme="http://duanyushuai.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>线程创建4个方法</title>
    <link href="http://duanyushuai.github.io/2021/04/07/%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA4%E4%B8%AA%E6%96%B9%E6%B3%95/"/>
    <id>http://duanyushuai.github.io/2021/04/07/%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA4%E4%B8%AA%E6%96%B9%E6%B3%95/</id>
    <published>2021-04-07T03:00:23.000Z</published>
    <updated>2022-06-13T15:00:03.170Z</updated>
    
    <content type="html"><![CDATA[<h4 id="线程创建4个方法"><a href="#线程创建4个方法" class="headerlink" title="线程创建4个方法"></a>线程创建4个方法</h4><p>创建线程4个方法</p><ol><li>继承Thread类创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;<span class="comment">//继承Thread类</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">　　<span class="comment">//重写run方法</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">MyThread</span>().start();<span class="comment">//创建并启动线程</span></span><br></pre></td></tr></table></figure><ol start="2"><li>实现Runnable接口创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;<span class="comment">//实现Runnable接口</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">　　<span class="comment">//重写run方法</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">　　　　<span class="comment">//创建并启动线程</span></span><br><span class="line">　　　　MyThread2 myThread=<span class="keyword">new</span> <span class="title class_">MyThread2</span>();</span><br><span class="line">　　　　Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(myThread);</span><br><span class="line">　　　　thread().start();</span><br><span class="line"></span><br><span class="line">　　　　<span class="comment">//或者    new Thread(new MyThread2()).start();</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>使用Callable和Future创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">// 先使用Lambda表达式创建Callable&lt;Integer&gt;对象</span></span><br><span class="line">       <span class="comment">// 使用FutureTask来包装Callable对象</span></span><br><span class="line">       FutureTask&lt;Integer&gt; task = <span class="keyword">new</span>  <span class="title class_">FutureTask</span>&lt;&gt;((Callable&lt;Integer&gt;)() -&gt; <span class="number">5</span>);</span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">Thread</span>(task).start();</span><br><span class="line">       <span class="keyword">try</span></span><br><span class="line">       &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;子线程的返回值：&quot;</span> +  task.get());</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">       &#123;</span><br><span class="line">           ex.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>使用线程池例如用Executor框架</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;线程创建4个方法&quot;&gt;&lt;a href=&quot;#线程创建4个方法&quot; class=&quot;headerlink&quot; title=&quot;线程创建4个方法&quot;&gt;&lt;/a&gt;线程创建4个方法&lt;/h4&gt;&lt;p&gt;创建线程4个方法&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;继承Thread类创建线程&lt;/li&gt;
&lt;/ol&gt;</summary>
      
    
    
    
    <category term="java" scheme="http://duanyushuai.github.io/categories/java/"/>
    
    
    <category term="java" scheme="http://duanyushuai.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>CompletableFuture</title>
    <link href="http://duanyushuai.github.io/2021/04/05/CompletableFuture/"/>
    <id>http://duanyushuai.github.io/2021/04/05/CompletableFuture/</id>
    <published>2021-04-05T03:00:23.000Z</published>
    <updated>2022-06-13T03:02:59.980Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h1><h3 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">supplyAsync</span><span class="params">(Supplier&lt;U&gt; supplier)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">supplyAsync</span><span class="params">(Supplier&lt;U&gt; supplier, Executor executor)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> CompletableFuture&lt;Void&gt; <span class="title function_">runAsync</span><span class="params">(Runnable runnable)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> CompletableFuture&lt;Void&gt; <span class="title function_">runAsync</span><span class="params">(Runnable runnable, Executor executor)</span>;</span><br></pre></td></tr></table></figure><p>supply:有返回结果</p><p>run：无返回结果</p><h3 id="获取结果"><a href="#获取结果" class="headerlink" title="获取结果"></a>获取结果</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T    <span class="title function_">get</span><span class="params">()</span></span><br><span class="line"><span class="keyword">public</span> T    <span class="title function_">get</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span></span><br><span class="line"><span class="keyword">public</span> T    <span class="title function_">getNow</span><span class="params">(T valueIfAbsent)</span></span><br><span class="line"><span class="keyword">public</span> T    <span class="title function_">join</span><span class="params">()</span></span><br></pre></td></tr></table></figure><h3 id="计算完成后续操作1——complete"><a href="#计算完成后续操作1——complete" class="headerlink" title="计算完成后续操作1——complete"></a>计算完成后续操作1——complete</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> CompletableFuture&lt;T&gt;     <span class="title function_">whenComplete</span><span class="params">(BiConsumer&lt;? <span class="built_in">super</span> T,? <span class="built_in">super</span> Throwable&gt; action)</span></span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;T&gt;     <span class="title function_">whenCompleteAsync</span><span class="params">(BiConsumer&lt;? <span class="built_in">super</span> T,? <span class="built_in">super</span> Throwable&gt; action)</span></span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;T&gt;     <span class="title function_">whenCompleteAsync</span><span class="params">(BiConsumer&lt;? <span class="built_in">super</span> T,? <span class="built_in">super</span> Throwable&gt; action, Executor executor)</span></span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;T&gt;     <span class="title function_">exceptionally</span><span class="params">(Function&lt;Throwable,? extends T&gt; fn)</span></span><br></pre></td></tr></table></figure><p>方法1和2的区别在于是否使用异步处理，2和3的区别在于是否使用自定义的线程池，前三个方法都会提供<strong>一个返回结果和可抛出异常</strong>，我们可以使用lambda表达式的来接收这两个参数，然后自己处理。 方法4，接收一个可抛出的异常，且必须return一个返回值，类型与钻石表达式种的类型一样，详见下文的<strong>exceptionally()</strong> </p><h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">10086</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        future.whenComplete((result, error) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;拨打&quot;</span>+result);</span><br><span class="line">            error.printStackTrace();</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><p>whenCompleteAsync  与  whenComplete 区别</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    CompletableFuture&lt;Integer&gt; f = <span class="keyword">new</span> <span class="title class_">CompletableFuture</span>&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// 子线程A启动</span></span><br><span class="line">        logger.info(<span class="string">&quot;子线程A启动&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;子线程A沉睡5s&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">5000l</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">&quot;子线程A令future完成&quot;</span>);</span><br><span class="line">        f.complete(<span class="number">100</span>);  <span class="comment">// 当子线程A执行到f.complete的时候，会去看是否有注册好的f的then或者when（非async的），如果有的话，会顺次去执行。</span></span><br><span class="line">        logger.info(<span class="string">&quot;子线程A结束&quot;</span>);</span><br><span class="line">    &#125;).start();;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前线程（主线程）执行到这里的时候，如果子线程还没有执行到f.complete(100)，</span></span><br><span class="line">    <span class="comment">// 那么当前线程会把whenComplete事件注册起来，并且说好哪个线程执行了f.complete(100)，</span></span><br><span class="line">    <span class="comment">// 哪个线程就负责执行whenComplete的内容。</span></span><br><span class="line">    <span class="comment">// 如果当前线程（主线程）执行到这里的时候，f.complete(100)已经被其他线程执行完毕了。</span></span><br><span class="line">    <span class="comment">// 那么只有当前线程自己来执行whenComplete里面的内容了。</span></span><br><span class="line">    f.whenCompleteAsync((i, ex) -&gt; &#123;</span><br><span class="line">        <span class="comment">// 这个场景下，whenComplete的回调的执行线程会是子线程A</span></span><br><span class="line">        logger.info(<span class="string">&quot;do something after complete begin&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;沉睡10s&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">10000l</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">&quot;do something after complete end&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">&quot;main over&quot;</span>);</span><br><span class="line">    System.in.read();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="计算完成后续操作2——handle"><a href="#计算完成后续操作2——handle" class="headerlink" title="计算完成后续操作2——handle"></a>计算完成后续操作2——handle</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt;     <span class="title function_">handle</span><span class="params">(BiFunction&lt;? <span class="built_in">super</span> T,Throwable,? extends U&gt; fn)</span></span><br><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt;     <span class="title function_">handleAsync</span><span class="params">(BiFunction&lt;? <span class="built_in">super</span> T,Throwable,? extends U&gt; fn)</span></span><br><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt;     <span class="title function_">handleAsync</span><span class="params">(BiFunction&lt;? <span class="built_in">super</span> T,Throwable,? extends U&gt; fn, Executor executor)</span></span><br></pre></td></tr></table></figure><p>方法返回类型可以自定义</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CompletableFuture&quot;&gt;&lt;a href=&quot;#CompletableFuture&quot; class=&quot;headerlink&quot; title=&quot;CompletableFuture&quot;&gt;&lt;/a&gt;CompletableFuture&lt;/h1&gt;&lt;h3 id=&quot;实例化&quot;&gt;</summary>
      
    
    
    
    <category term="java" scheme="http://duanyushuai.github.io/categories/java/"/>
    
    
    <category term="java" scheme="http://duanyushuai.github.io/tags/java/"/>
    
    <category term="CompletableFuture" scheme="http://duanyushuai.github.io/tags/CompletableFuture/"/>
    
  </entry>
  
  <entry>
    <title>Jvisualvm</title>
    <link href="http://duanyushuai.github.io/2021/03/10/Jvisualvm/"/>
    <id>http://duanyushuai.github.io/2021/03/10/Jvisualvm/</id>
    <published>2021-03-10T02:00:00.000Z</published>
    <updated>2022-07-24T13:18:06.389Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Jvisualvm"><a href="#Jvisualvm" class="headerlink" title="Jvisualvm"></a>Jvisualvm</h2><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><a href="https://visualvm.github.io/download.html">https://visualvm.github.io/download.html</a></p><h3 id="打开扩大字体"><a href="#打开扩大字体" class="headerlink" title="打开扩大字体"></a>打开扩大字体</h3><p>打开bin</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visualvm.exe --fontsize 20</span><br></pre></td></tr></table></figure><p>下载</p><p>visual GC</p><p><img src="/../img/jvisualvm1.jpg"></p><p>在GC开始的时候，对象只会存在于Eden区和名为“From”的Survivor区，Survivor区“To”是空的。紧接着进行GC，Eden区中所有存活的对象都会被复制到“To”，而在“From”区中，仍存活的对象会根据他们的年龄值来决定去向。年龄达到一定值(年龄阈值，可以通过-XX:MaxTenuringThreshold来设置)的对象会被移动到年老代中，没有达到阈值的对象会被复制到“To”区域。经过这次GC后，Eden区和From区已经被清空。这个时候，“From”和“To”会交换他们的角色，也就是新的“To”就是上次GC前的“From”，新的“From”就是上次GC前的“To”。不管怎样，都会保证名为To的Survivor区域是空的。Minor GC会一直重复这样的过程，直到“To”区被填满，“To”区被填满之后，会将所有对象移动到年老代中。</p><p><img src="/../img/jvisualvm2.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Jvisualvm&quot;&gt;&lt;a href=&quot;#Jvisualvm&quot; class=&quot;headerlink&quot; title=&quot;Jvisualvm&quot;&gt;&lt;/a&gt;Jvisualvm&lt;/h2&gt;&lt;h3 id=&quot;下载&quot;&gt;&lt;a href=&quot;#下载&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="java" scheme="http://duanyushuai.github.io/categories/java/"/>
    
    <category term="Jvisualvm" scheme="http://duanyushuai.github.io/categories/java/Jvisualvm/"/>
    
    
    <category term="java" scheme="http://duanyushuai.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>maven</title>
    <link href="http://duanyushuai.github.io/2021/03/09/maven_20220711_172008/"/>
    <id>http://duanyushuai.github.io/2021/03/09/maven_20220711_172008/</id>
    <published>2021-03-09T02:00:00.000Z</published>
    <updated>2022-07-24T13:18:04.266Z</updated>
    
    <content type="html"><![CDATA[<h1 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h1><h3 id="maven-私服配置"><a href="#maven-私服配置" class="headerlink" title="maven 私服配置"></a>maven 私服配置</h3><h4 id="setting配置"><a href="#setting配置" class="headerlink" title="setting配置"></a>setting配置</h4><p><img src="/../img/maven1.png"></p><h4 id="项目-pom-xml配置maven私服访问地址"><a href="#项目-pom-xml配置maven私服访问地址" class="headerlink" title="项目 pom.xml配置maven私服访问地址"></a>项目 pom.xml配置maven私服访问地址</h4><p>因为maven默认会有一个下载地址，我们要重写下载地址，改写成自己的私服地址</p><p><img src="/../img/maven2.png"></p><h4 id="如果需要打包到私服，需要配置打包私服相关参数"><a href="#如果需要打包到私服，需要配置打包私服相关参数" class="headerlink" title="如果需要打包到私服，需要配置打包私服相关参数"></a>如果需要打包到私服，需要配置打包私服相关参数</h4><p><img src="/../img/maven3.png"></p><h4 id="reository和mirror加载顺序"><a href="#reository和mirror加载顺序" class="headerlink" title="reository和mirror加载顺序"></a>reository和mirror加载顺序</h4><p>1、在mirrorOf与repositoryId相同的时候优先是使用mirror的地址</p><p>2、mirrorOf等于*的时候覆盖所有repository配置</p><p>3、存在多个mirror配置的时候mirrorOf等于*放到最后</p><p>4、只配置mirrorOf为central的时候可以不用配置repository</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;maven&quot;&gt;&lt;a href=&quot;#maven&quot; class=&quot;headerlink&quot; title=&quot;maven&quot;&gt;&lt;/a&gt;maven&lt;/h1&gt;&lt;h3 id=&quot;maven-私服配置&quot;&gt;&lt;a href=&quot;#maven-私服配置&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="maven" scheme="http://duanyushuai.github.io/categories/maven/"/>
    
    
    <category term="maven" scheme="http://duanyushuai.github.io/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>mysql中join的使用</title>
    <link href="http://duanyushuai.github.io/2021/01/03/mysql%E4%B8%ADjoin%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://duanyushuai.github.io/2021/01/03/mysql%E4%B8%ADjoin%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2021-01-03T02:00:00.000Z</published>
    <updated>2022-06-26T10:39:21.188Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mysql-中join的使用"><a href="#mysql-中join的使用" class="headerlink" title="mysql 中join的使用"></a>mysql 中join的使用</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;mysql-中join的使用&quot;&gt;&lt;a href=&quot;#mysql-中join的使用&quot; class=&quot;headerlink&quot; title=&quot;mysql 中join的使用&quot;&gt;&lt;/a&gt;mysql 中join的使用&lt;/h2&gt;</summary>
      
    
    
    
    
  </entry>
  
</feed>
