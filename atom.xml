<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Duan</title>
  
  <subtitle>有点小菜</subtitle>
  <link href="http://duanyushuai.github.io/atom.xml" rel="self"/>
  
  <link href="http://duanyushuai.github.io/"/>
  <updated>2022-08-28T06:31:55.451Z</updated>
  <id>http://duanyushuai.github.io/</id>
  
  <author>
    <name>小段</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SpringSecurity</title>
    <link href="http://duanyushuai.github.io/2022/08/27/SpringSecuity/"/>
    <id>http://duanyushuai.github.io/2022/08/27/SpringSecuity/</id>
    <published>2022-08-27T07:58:07.374Z</published>
    <updated>2022-08-28T06:31:55.451Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringSecuity"><a href="#SpringSecuity" class="headerlink" title="SpringSecuity"></a>SpringSecuity</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SpringSecurity是一个过滤器链</p><p>UsernamePasswordAuthenticationFilter: 负责填写用户名密码后的登陆请求</p><p>ExceptionTranslationFilter: 处理过滤器链中跑出的任何AccessDeniedException和AuthenticationException</p><p>FilterSecurityInterceptor: 负责权限校验的过滤器</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SpringSecuity&quot;&gt;&lt;a href=&quot;#SpringSecuity&quot; class=&quot;headerlink&quot; title=&quot;SpringSecuity&quot;&gt;&lt;/a&gt;SpringSecuity&lt;/h1&gt;&lt;figure class=&quot;highlight xml&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>JWT理解</title>
    <link href="http://duanyushuai.github.io/2022/08/18/Jwt%E7%90%86%E8%A7%A3/"/>
    <id>http://duanyushuai.github.io/2022/08/18/Jwt%E7%90%86%E8%A7%A3/</id>
    <published>2022-08-18T02:00:00.000Z</published>
    <updated>2022-08-28T06:35:00.527Z</updated>
    
    <content type="html"><![CDATA[<h1 id="JWT理解"><a href="#JWT理解" class="headerlink" title="JWT理解"></a>JWT理解</h1><h4 id="jwt组成"><a href="#jwt组成" class="headerlink" title="jwt组成"></a>jwt组成</h4><ol><li>标头（Header）</li><li>有效载荷（Payload）</li><li>签名（ Signature）</li></ol><p>格式 xxx.yyy.zzz</p><h5 id="标头"><a href="#标头" class="headerlink" title="标头"></a>标头</h5><p>令牌类型和所属签名 base64 编码</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span></span><br><span class="line">    <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jwt&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="有效载荷"><a href="#有效载荷" class="headerlink" title="有效载荷"></a>有效载荷</h5><p>声明的实体。base64编码</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2123&quot;</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dd&quot;</span></span><br><span class="line">   <span class="attr">&quot;admin&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h5><p>使用密钥对header和payload进行签名，防止被容被篡改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(BASE64UrlEncode(header)+.+BASE64UrlEncode(payload),secret);</span><br></pre></td></tr></table></figure><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">      HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">     <span class="type">Calendar</span> <span class="variable">instance</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">     instance.add(Calendar.SECOND,<span class="number">20</span> );</span><br><span class="line">     <span class="keyword">final</span> <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> JWT.create().withHeader(map)</span><br><span class="line">             .withClaim(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;123&quot;</span>)</span><br><span class="line">             .withExpiresAt(instance.getTime())</span><br><span class="line">             .sign(Algorithm.HMAC256(<span class="string">&quot;123&quot;</span>));</span><br><span class="line"></span><br><span class="line">     System.out.println(username );</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test2</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="keyword">final</span> <span class="type">JWTVerifier</span> <span class="variable">jwtVerifier</span> <span class="operator">=</span> JWT.require(Algorithm.HMAC256(<span class="string">&quot;123&quot;</span>)).build();</span><br><span class="line">     <span class="type">DecodedJWT</span> <span class="variable">verify</span> <span class="operator">=</span> jwtVerifier.verify(<span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE2NjE1ODI2NDcsInVzZXJuYW1lIjoiMTIzIn0.b45eaJCa5uzUdGIfXfrjhw73AdzH-MXgkAI8hOY6wYU&quot;</span>);</span><br><span class="line">     System.out.println(verify);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;JWT理解&quot;&gt;&lt;a href=&quot;#JWT理解&quot; class=&quot;headerlink&quot; title=&quot;JWT理解&quot;&gt;&lt;/a&gt;JWT理解&lt;/h1&gt;&lt;h4 id=&quot;jwt组成&quot;&gt;&lt;a href=&quot;#jwt组成&quot; class=&quot;headerlink&quot; title=&quot;jwt</summary>
      
    
    
    
    <category term="java web" scheme="http://duanyushuai.github.io/categories/java-web/"/>
    
    
    <category term="java web" scheme="http://duanyushuai.github.io/tags/java-web/"/>
    
  </entry>
  
  <entry>
    <title>分布式事务</title>
    <link href="http://duanyushuai.github.io/2022/08/14/%E4%BA%8B%E5%8A%A1/"/>
    <id>http://duanyushuai.github.io/2022/08/14/%E4%BA%8B%E5%8A%A1/</id>
    <published>2022-08-14T09:48:41.791Z</published>
    <updated>2022-08-19T14:13:16.002Z</updated>
    
    <content type="html"><![CDATA[<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><h3 id="数据库事务"><a href="#数据库事务" class="headerlink" title="数据库事务"></a>数据库事务</h3><h4 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h4><p>原子性 一致性 隔离性 持久性</p><h4 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h4><ol><li><strong>Read uncommitted</strong></li></ol><p>读未提交读 ，读到其他事务未提交的数据，脏读</p><ol start="2"><li><strong>Read committed</strong></li></ol><p>读提交读，读到另一个事务的提交数据，在一个事务中，读取的数据不一样，形成不可重复读</p><ol start="3"><li><p><strong>Repeatable read</strong></p><p>mysql 默认的隔离级别，在同一个事务里，select 的结果是事务开始时时间点的状态，因此，同样的 select 操作读到的结果会是一致的，但是，会有幻读现象。MySQL 的 InnoDB 引擎可以通过 next-key locks 机制来避免幻读。</p></li><li><p><strong>Serializable</strong></p></li></ol><p>序列化</p><h4 id="事务的传播行为"><a href="#事务的传播行为" class="headerlink" title="事务的传播行为"></a>事务的传播行为</h4><p><strong>1</strong>、<strong>PROPAGATION_REQUIRED</strong>：如果当前没有事务，就创建一个新事务，如果当前存在事务， </p><p>就加入该事务，该设置是最常用的设置。 </p><p><strong>2</strong>、<strong>PROPAGATION_SUPPORTS</strong>：支持当前事务，如果当前存在事务，就加入该事务，如果当 </p><p>前不存在事务，就以非事务执行。 </p><p><strong>3</strong>、<strong>PROPAGATION_MANDATORY</strong>：支持当前事务，如果当前存在事务，就加入该事务，如果 </p><p>当前不存在事务，就抛出异常。 </p><p><strong>4</strong>、<strong>PROPAGATION_REQUIRES_NEW</strong>：创建新事务，无论当前存不存在事务，都创建新事务。 </p><p><strong>5</strong>、<strong>PROPAGATION_NOT_SUPPORTED</strong>：以非事务方式执行操作，如果当前存在事务，就把当 </p><p>前事务挂起。 </p><p><strong>6</strong>、<strong>PROPAGATION_NEVER</strong>：以非事务方式执行，如果当前存在事务，则抛出异常。 </p><p><strong>7</strong>、<strong>PROPAGATION_NESTED</strong>：如果当前存在事务，则在嵌套事务内执行。如果当前没有事务， </p><p>则执行与 PROPAGATION_REQUIRED 类似的操作。</p><p><strong>同一个对象内事务方法互相调失效，原因绕过了代理对象</strong></p><p>解决：使用代理对象来调用事务方法</p><p> 1）、引入aop-starter;spring-boot-starter-aop; 引入aspectj</p><p> 2）、@EnableAspectJAutoProxy; 开启 aspectj 动态代理功能，以后的代理对象都是aspectj </p><p>0）、导入 spring-boot-starter-aop </p><p>1）、@EnableTransactionManagement(proxyTargetClass &#x3D; true) </p><p>2）、@EnableAspectJAutoProxy(exposeProxy&#x3D;true) </p><p>3）、AopContext.currentProxy() 调用方法 </p><h3 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h3><h4 id="CAP-原理"><a href="#CAP-原理" class="headerlink" title="CAP 原理"></a>CAP 原理</h4><p>CAP 原则又称 CAP 定理，指的是在一个分布式系统中 </p><p>一致性（Consistency）： </p><p>在分布式系统中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本） </p><p>可用性（Availability） </p><p>在集群中一部分节点故障后，集群整体是否还能响应客户端的读写请求。（对数据 更新具备高可用性） </p><p>分区容错性（Partition tolerance） </p><p>大多数分布式系统都分布在多个子网络。每个子网络就叫做一个区（</p><p>partition）。 分区容错的意思是，区间通信可能失败。比如，一台服务器放在中国，另一台服务器放在美国，这就是两个区，它们之间可能无法通信。 </p><p>CAP 原则指的是，这三个要素最多只能同时实现两点，<strong>不可能三者兼顾</strong>。</p><p>一般来说，分区容错无法避免，因此可以认为 CAP 的 P 总是成立。CAP 定理告诉我们， </p><p>剩下的 C 和 A 无法同时做到。</p><p>分布式系统中实现一致性的 raft 算法、paxos </p><p><a href="http://thesecretlivesofdata.com/raft/">http://thesecretlivesofdata.com/raft/</a></p><h3 id="分布式事务解决方案"><a href="#分布式事务解决方案" class="headerlink" title="分布式事务解决方案"></a>分布式事务解决方案</h3><h5 id="2PC模式"><a href="#2PC模式" class="headerlink" title="2PC模式"></a>2PC模式</h5><p>数据库支持的 2PC【2 phase commit 二阶提交】，又叫做 XA Transactions。 </p><p>MySQL 从 5.5 版本开始支持，SQL Server 2005 开始支持，Oracle 7 开始支持。 </p><p>其中，XA 是一个两阶段提交协议，该协议分为以下两个阶段： </p><p>第一阶段：事务协调器要求每个涉及到事务的数据库预提交(precommit)此操作，并反映是 </p><p>否可以提交. </p><p>第二阶段：事务协调器要求每个数据库提交数据。 </p><p>其中，如果有任何一个数据库否决此次提交，那么所有数据库都会被要求回滚它们在此事务 </p><p>中的那部分信息。</p><ul><li>XA 协议比较简单，而且一旦商业数据库实现了 XA 协议，使用分布式事务的成本也比较</li></ul><p>低。 </p><ul><li><strong>XA</strong> <strong>性能不理想</strong>，特别是在交易下单链路，往往并发量很高，XA 无法满足高并发场景 </li><li>XA 目前在商业数据库支持的比较理想，<strong>在</strong> <strong>mysql</strong> <strong>数据库中支持的不太理想</strong>，mysql 的 XA 实现，没有记录 prepare 阶段日志，主备切换回导致主库与备库数据不一致。 许多 nosql 也没有支持 XA，这让 XA 的应用场景变得非常狭隘。 </li><li>也有 3PC，引入了超时机制（无论协调者还是参与者，在向对方发送请求后，若长时间 未收到回应则做出相应处理）</li></ul><h5 id="柔性事务-TCC-事务补偿型方案"><a href="#柔性事务-TCC-事务补偿型方案" class="headerlink" title="柔性事务 TCC 事务补偿型方案"></a>柔性事务 TCC <strong>事务补偿型方案</strong></h5><p>刚性事务：遵循 ACID 原则，强一致性。 </p><p>柔性事务：遵循 BASE 理论，最终一致性； </p><p>与刚性事务不同，柔性事务允许一定时间内，不同节点的数据不一致，但要求最终一致。</p><h5 id="柔性事务-最大努力通知方案"><a href="#柔性事务-最大努力通知方案" class="headerlink" title="柔性事务 最大努力通知方案"></a>柔性事务 最大努力通知方案</h5><p>按规律进行通知，<strong>不保证数据一定能通知成功，但会提供可查询操作接口进行核对</strong>。这种 </p><p>方案主要用在与第三方系统通讯时，比如：调用微信或支付宝支付后的支付结果通知。这种 </p><p>方案也是结合 MQ 进行实现，例如：通过 MQ 发送 http 请求，设置最大通知次数。达到通 </p><p>知次数后即不再通知。 </p><p>案例：银行通知、商户通知等（各大交易业务平台间的商户通知：多次通知、查询校对、对 </p><p>账文件），支付宝的支付成功异步回调</p><h5 id="柔性事务-可靠消息-最终一致性"><a href="#柔性事务-可靠消息-最终一致性" class="headerlink" title="柔性事务 + 可靠消息 + 最终一致性"></a>柔性事务 + 可靠消息 + 最终一致性</h5><p>实现：业务处理服务在业务事务提交之前，向实时消息服务请求发送消息，实时消息服务只 </p><p>记录消息数据，而不是真正的发送。业务处理服务在业务事务提交之后，向实时消息服务确 </p><p>认发送。只有在得到确认发送指令后，实时消息服务才会真正发送。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;事务&quot;&gt;&lt;a href=&quot;#事务&quot; class=&quot;headerlink&quot; title=&quot;事务&quot;&gt;&lt;/a&gt;事务&lt;/h1&gt;&lt;h3 id=&quot;数据库事务&quot;&gt;&lt;a href=&quot;#数据库事务&quot; class=&quot;headerlink&quot; title=&quot;数据库事务&quot;&gt;&lt;/a&gt;数据库事</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>接口幂等性</title>
    <link href="http://duanyushuai.github.io/2022/08/10/%E6%8E%A5%E5%8F%A3%E5%B9%82%E7%AD%89%E6%80%A7/"/>
    <id>http://duanyushuai.github.io/2022/08/10/%E6%8E%A5%E5%8F%A3%E5%B9%82%E7%AD%89%E6%80%A7/</id>
    <published>2022-08-10T02:00:00.000Z</published>
    <updated>2022-08-11T14:06:32.123Z</updated>
    
    <content type="html"><![CDATA[<h1 id="接口幂等性"><a href="#接口幂等性" class="headerlink" title="接口幂等性"></a>接口幂等性</h1><p>问题出现</p><ol><li>用户多次点击</li><li>用户回退在提交</li><li>feign触发重试</li></ol><h3 id="1-token"><a href="#1-token" class="headerlink" title="1.token"></a>1.token</h3><p> token 的获取、比较和删除必须是原子性的</p><p>使用redis和lua脚本</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&#x27;get&#x27;</span>,KEYS[<span class="number">1</span>]==ARGV[<span class="number">1</span>] <span class="keyword">then</span> <span class="keyword">return</span> is.call(<span class="string">&#x27;del&#x27;</span>,KEYS[<span class="number">1</span>])) <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="2-各种锁机制"><a href="#2-各种锁机制" class="headerlink" title="2. 各种锁机制"></a>2. 各种锁机制</h3><h4 id="1-数据库悲观锁"><a href="#1-数据库悲观锁" class="headerlink" title="1. 数据库悲观锁"></a>1. 数据库悲观锁</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from xxxx where id=1 for update</span><br></pre></td></tr></table></figure><p>id一定是主键和唯一索引，不然可能造成锁表</p><h4 id="2-数据库乐观锁"><a href="#2-数据库乐观锁" class="headerlink" title="2. 数据库乐观锁"></a>2. 数据库乐观锁</h4><p>首先获取这条数据的版本号version，然后操作的时候带上版本号</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update goods <span class="type">set</span> <span class="variable">count</span> <span class="operator">=</span> count -<span class="number">1</span> ,version = version + <span class="number">1</span> <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">2</span> <span class="type">and</span> <span class="variable">version</span> <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>乐观锁处理读多写少问题</p><h3 id="3-业务分布式锁"><a href="#3-业务分布式锁" class="headerlink" title="3. 业务分布式锁"></a>3. 业务分布式锁</h3><h3 id="4-各种唯一索引"><a href="#4-各种唯一索引" class="headerlink" title="4. 各种唯一索引"></a>4. 各种唯一索引</h3><h4 id="数据库的唯一约束"><a href="#数据库的唯一约束" class="headerlink" title="数据库的唯一约束"></a>数据库的唯一约束</h4><p>插入数据按照唯一索引，比如订单号，相同的订单号就不能重复插入。需要不是自增主键，代码生成全局唯一id。</p><p>在分库分表下，根据路由规则，要路由到同一张表，才能是唯一索引有意义。</p><h4 id="redis防重"><a href="#redis防重" class="headerlink" title="redis防重"></a>redis防重</h4><p>我们可以计算上传数据的MD5值，存到redis set，每次处理数据，去和redis进行匹配</p><h4 id="防重表"><a href="#防重表" class="headerlink" title="防重表"></a>防重表</h4><p>把orderNo作为去重表的唯一索引插入mysql，去重表和业务表处在同一数据库，处于同一事务，方便回滚</p><h3 id="5-全局请求唯一id"><a href="#5-全局请求唯一id" class="headerlink" title="5.全局请求唯一id"></a>5.全局请求唯一id</h3><p>调用接口生成唯一id，保存在redis的集合中。</p><p>可以使用nginx设置请求的唯一id</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header  X-Request-Id $request_id;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;接口幂等性&quot;&gt;&lt;a href=&quot;#接口幂等性&quot; class=&quot;headerlink&quot; title=&quot;接口幂等性&quot;&gt;&lt;/a&gt;接口幂等性&lt;/h1&gt;&lt;p&gt;问题出现&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用户多次点击&lt;/li&gt;
&lt;li&gt;用户回退在提交&lt;/li&gt;
&lt;li&gt;feign触发</summary>
      
    
    
    
    <category term="java web" scheme="http://duanyushuai.github.io/categories/java-web/"/>
    
    
    <category term="java web" scheme="http://duanyushuai.github.io/tags/java-web/"/>
    
  </entry>
  
  <entry>
    <title>视频工具</title>
    <link href="http://duanyushuai.github.io/2022/07/29/%E5%B7%A5%E5%85%B7/"/>
    <id>http://duanyushuai.github.io/2022/07/29/%E5%B7%A5%E5%85%B7/</id>
    <published>2022-07-29T06:11:08.153Z</published>
    <updated>2022-08-27T02:26:36.524Z</updated>
    
    <content type="html"><![CDATA[<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><p>你有没有想过，在自己常用的网站地址前加几个字符，就可以实现各种各样的效果？</p><p>无需安装任何软件，就能解析视频、下载音乐、复制文库……是的你没看错，只需要简单地添加一个前缀，就能解决。</p><ul><li><strong>视频解析</strong></li></ul><p>找到你喜欢的电影&#x2F;电视剧，打开它所在当前网页。</p><p>不论是爱奇艺，腾讯视频还是其他视频网站，只需要在网站前加上wn.run&#x2F;这串字符。</p><p>注意：一定要在http或https前面添加。</p><p><img src="/../img/gongju1.png" alt="图片"></p><p>然后按下回车，就会跳转至一个名为万能命令的新页面。</p><p>在下方【相关视频播放】这一栏里，就是你想观看的视频的解析结果。</p><p><img src="/../img/gongju2.png" alt="图片"></p><p>任选一个解析网站打开，就可以全屏观看该视频了。</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><ul><li><strong>文库下载</strong></li></ul><p>对于工作党和学生党来说，最痛苦的事情，莫过于找到了急需的资料，却没有文库VIP了。</p><p>在某度文库上，如果没有开通VIP的话，既无法复制文字，也无法下载文档，几乎是寸步难行。</p><p>这时候，我们只需要在所需文档地址前加上wn.run&#x2F;前缀。</p><p>按下回车，就可以找到文库在线下载的解析结果了。</p><p>点击上述结果，即会自动跳转至一个名为网页转换助手的页面。</p><p>在这里，你可以选择【转为Word】或【转为PDF】。</p><p>然后点击【下载】按钮，就能成功下载该会员文档的源文件了。</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><ul><li><strong>音乐下载</strong></li></ul><p>如果想要下载网易云音乐、QQ音乐、酷狗音乐上的歌曲，只需在播放地址前加上wn.run&#x2F;。</p><p>然后选择其中一个解析源，就能下载歌曲了。</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><ul><li><strong>视频下载</strong></li></ul><p>当然，这个小技巧不仅能用于下载音乐，同时也可以用来下载各个视频网站上的视频。</p><p>以B站为例，在网址前输入wn.run&#x2F;。</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p>然后回车，选择其中一个解析结果，就可以成功下载该视频了。</p><p>除了上面介绍的功能，通过wn.run&#x2F;这个命令还能实现许许多多的效果，比如网页翻译、网页截图、网页二维码生成等等。</p><p>每个功能都无需下载、即用即走，且没有平台限制，pc、android、ios等都可使用。</p><p>另外，在万能命令网站里，还收录了很多高质量的工具，大家感兴趣的话，也可以直接收藏这个地址。</p><p>鉴于这个工具比较敏感，如果大家有需要的话，就赶紧试试吧！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;工具&quot;&gt;&lt;a href=&quot;#工具&quot; class=&quot;headerlink&quot; title=&quot;工具&quot;&gt;&lt;/a&gt;工具&lt;/h1&gt;&lt;p&gt;你有没有想过，在自己常用的网站地址前加几个字符，就可以实现各种各样的效果？&lt;/p&gt;
&lt;p&gt;无需安装任何软件，就能解析视频、下载音乐、复制文库</summary>
      
    
    
    
    <category term="工具" scheme="http://duanyushuai.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="工具" scheme="http://duanyushuai.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>redis 缓存</title>
    <link href="http://duanyushuai.github.io/2022/07/11/redis%20%E7%BC%93%E5%AD%98/"/>
    <id>http://duanyushuai.github.io/2022/07/11/redis%20%E7%BC%93%E5%AD%98/</id>
    <published>2022-07-11T13:46:55.260Z</published>
    <updated>2022-07-12T13:52:10.751Z</updated>
    
    <content type="html"><![CDATA[<h1 id="redis-缓存"><a href="#redis-缓存" class="headerlink" title="redis 缓存"></a>redis 缓存</h1><h4 id="那些数据适合缓存"><a href="#那些数据适合缓存" class="headerlink" title="那些数据适合缓存"></a>那些数据适合缓存</h4><ol><li><p>即时性和数据一致性要求不高的</p></li><li><p>读多写少</p></li></ol><p>使用redis</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line"> &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>简单的分布式锁</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;Catelog2Vo&gt;&gt; <span class="title function_">getCatalogJsonFromDbWithRedislock</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 占分布式锁，去redis占坑</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">lock</span> <span class="operator">=</span> redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;lock&quot;</span>, uuid, <span class="number">300</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">if</span> (lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;获取分布式锁成功&quot;</span>);</span><br><span class="line">            <span class="comment">// 加锁成功...执行业务</span></span><br><span class="line">            <span class="comment">// 2 设置过期时间</span></span><br><span class="line"><span class="comment">//            redisTemplate.expire(&quot;lock&quot;, 30, TimeUnit.SECONDS);</span></span><br><span class="line">            Map&lt;String, List&lt;Catelog2Vo&gt;&gt; dataFromDB;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                dataFromDB = getDataFromDB();</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line">                <span class="comment">// 删除锁</span></span><br><span class="line">                <span class="type">Long</span> <span class="variable">lock1</span> <span class="operator">=</span> redisTemplate.execute(<span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;Long&gt;(script, Long.class), Arrays.asList(<span class="string">&quot;lock&quot;</span>), uuid);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            redisTemplate.delete(&quot;lock&quot;);</span></span><br><span class="line">            <span class="comment">// 获取值对比 + 对比成功删除 = 原子操作  lua脚本解锁</span></span><br><span class="line"><span class="comment">//            String lockValue = redisTemplate.opsForValue().get(&quot;lock&quot;);</span></span><br><span class="line"><span class="comment">//            if (uuid.equals(lockValue)) &#123;</span></span><br><span class="line"><span class="comment">//                // 删除我自己的锁</span></span><br><span class="line"><span class="comment">//                redisTemplate.delete(&quot;lock&quot;);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> dataFromDB;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 加锁失败</span></span><br><span class="line">            <span class="comment">// 休眠100ms重试</span></span><br><span class="line">            System.out.println(<span class="string">&quot;获取分布式锁失败...等待重试&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> getCatalogJsonFromDbWithRedislock(); <span class="comment">// 自旋的方式</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;redis-缓存&quot;&gt;&lt;a href=&quot;#redis-缓存&quot; class=&quot;headerlink&quot; title=&quot;redis 缓存&quot;&gt;&lt;/a&gt;redis 缓存&lt;/h1&gt;&lt;h4 id=&quot;那些数据适合缓存&quot;&gt;&lt;a href=&quot;#那些数据适合缓存&quot; class=&quot;head</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>nginx使用</title>
    <link href="http://duanyushuai.github.io/2022/07/02/nginx%E4%BD%BF%E7%94%A8/"/>
    <id>http://duanyushuai.github.io/2022/07/02/nginx%E4%BD%BF%E7%94%A8/</id>
    <published>2022-07-02T10:30:26.308Z</published>
    <updated>2022-07-02T10:34:50.961Z</updated>
    
    <content type="html"><![CDATA[<h1 id="nginx使用"><a href="#nginx使用" class="headerlink" title="nginx使用"></a>nginx使用</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;nginx使用&quot;&gt;&lt;a href=&quot;#nginx使用&quot; class=&quot;headerlink&quot; title=&quot;nginx使用&quot;&gt;&lt;/a&gt;nginx使用&lt;/h1&gt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>sku和spu数据库设计</title>
    <link href="http://duanyushuai.github.io/2022/06/26/sku%E5%92%8Cspu%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/"/>
    <id>http://duanyushuai.github.io/2022/06/26/sku%E5%92%8Cspu%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/</id>
    <published>2022-06-26T10:50:48.206Z</published>
    <updated>2022-07-03T02:56:31.206Z</updated>
    
    <content type="html"><![CDATA[<h2 id="sku和spu数据库设计"><a href="#sku和spu数据库设计" class="headerlink" title="sku和spu数据库设计"></a>sku和spu数据库设计</h2><p><img src="/../img/skuspu1.png"></p><p><img src="/../img/skuspu2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;sku和spu数据库设计&quot;&gt;&lt;a href=&quot;#sku和spu数据库设计&quot; class=&quot;headerlink&quot; title=&quot;sku和spu数据库设计&quot;&gt;&lt;/a&gt;sku和spu数据库设计&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/../img/skuspu1.png&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>自定义注解</title>
    <link href="http://duanyushuai.github.io/2022/06/26/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%88%E6%A0%A1%E9%AA%8C%E5%92%8C%E6%97%A5%E5%BF%97%EF%BC%89/"/>
    <id>http://duanyushuai.github.io/2022/06/26/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%88%E6%A0%A1%E9%AA%8C%E5%92%8C%E6%97%A5%E5%BF%97%EF%BC%89/</id>
    <published>2022-06-26T03:34:51.020Z</published>
    <updated>2022-07-02T07:51:02.580Z</updated>
    
    <content type="html"><![CDATA[<h2 id="自定义注解（校验和日志）"><a href="#自定义注解（校验和日志）" class="headerlink" title="自定义注解（校验和日志）"></a>自定义注解（校验和日志）</h2><h2 id="JSR303-自定义校验"><a href="#JSR303-自定义校验" class="headerlink" title="JSR303 自定义校验"></a>JSR303 自定义校验</h2><h4 id="创建ListValue校验注解"><a href="#创建ListValue校验注解" class="headerlink" title="创建ListValue校验注解"></a>创建ListValue校验注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yxj.gulimall.common.valid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.Constraint;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Payload;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 自定义校验注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint(</span></span><br><span class="line"><span class="meta">        validatedBy = &#123;ListValueConstraintValidator.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ListValue &#123;</span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&#123;com.chenxin.gulimail.common.valid.ListValue.message&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[] vals() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ListValueConstraintValidator校验器"><a href="#ListValueConstraintValidator校验器" class="headerlink" title="ListValueConstraintValidator校验器"></a>ListValueConstraintValidator校验器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    Set&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Integer&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> constraintAnnotation</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ListValue constraintAnnotation)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] vals = constraintAnnotation.vals();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> val : vals) &#123;</span><br><span class="line">            set.add(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 真正的校验规则</span></span><br><span class="line"><span class="comment">     * 判断是否校验成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> constraintValidatorContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(Integer integer, ConstraintValidatorContext constraintValidatorContext)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> set.contains(integer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;自定义注解（校验和日志）&quot;&gt;&lt;a href=&quot;#自定义注解（校验和日志）&quot; class=&quot;headerlink&quot; title=&quot;自定义注解（校验和日志）&quot;&gt;&lt;/a&gt;自定义注解（校验和日志）&lt;/h2&gt;&lt;h2 id=&quot;JSR303-自定义校验&quot;&gt;&lt;a href=&quot;#J</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>redis Guava 缓存</title>
    <link href="http://duanyushuai.github.io/2022/06/26/redis-Guava-%E7%BC%93%E5%AD%98/"/>
    <id>http://duanyushuai.github.io/2022/06/26/redis-Guava-%E7%BC%93%E5%AD%98/</id>
    <published>2022-06-26T02:00:00.000Z</published>
    <updated>2022-07-24T13:18:01.257Z</updated>
    
    <content type="html"><![CDATA[<h2 id="redis-Guava-缓存"><a href="#redis-Guava-缓存" class="headerlink" title="redis Guava 缓存"></a>redis Guava 缓存</h2><h3 id="redis-懒加载"><a href="#redis-懒加载" class="headerlink" title="redis 懒加载"></a>redis 懒加载</h3><p>数据在新增到 MySQL 不进行缓存，在精确查找进行缓存，做到查询即缓存，不查询不缓存。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 伪代码示例 Xx代表你的的业务对象 如User Goods等等</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XxLazyCache</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Xx&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> XxService xxService;<span class="comment">// 你的业务service</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询 通过查询缓存是否存在驱动缓存加载 建议在前置业务保证id对应数据是绝对存在于数据库中的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Xx <span class="title function_">getXx</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询缓存里面有没有数据</span></span><br><span class="line">        <span class="type">Xx</span> <span class="variable">xxCache</span> <span class="operator">=</span> getXxFromCache(id);</span><br><span class="line">        <span class="keyword">if</span>(xxCache != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> xxCache;<span class="comment">// 卫语句使代码更有利于阅读</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.查询数据库获取数据 我们假定到业务这一步，传过来的id都在数据库中有对应数据</span></span><br><span class="line">        <span class="type">Xx</span> <span class="variable">xx</span> <span class="operator">=</span> xxService.getXxById(id);</span><br><span class="line">        <span class="comment">// 3.设置缓存、这一步相当于Redis缓存懒加载，下次再查询此id，则会走缓存</span></span><br><span class="line">        setXxFromCache(xx);</span><br><span class="line">        <span class="keyword">return</span> xx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对xx数据进行修改或者删除操作 操作数据库成功后 删除缓存</span></span><br><span class="line"><span class="comment">     * 删除请求 - 删除数据库数据 删除缓存</span></span><br><span class="line"><span class="comment">     * 修改请求 - 更新数据库数据 删除缓存 下次在查询时候就会从数据库拉取新的数据到缓存中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteXxFromCache</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;Xx:&quot;</span> + xx.getId();</span><br><span class="line">        redisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setXxFromCache</span><span class="params">(Xx xx)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;Xx:&quot;</span> + xx.getId();</span><br><span class="line">        redisTemplate.opsForValue().set(key, xx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Xx <span class="title function_">getXxFromCache</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过缓存前缀拼装唯一主键作为缓存Key 如Xxx信息 就是Xxx:id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;Xx:&quot;</span> + id;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 业务类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XxServie</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> XxLazyCache xxLazyCache;</span><br><span class="line">    <span class="comment">// 查询数据库</span></span><br><span class="line">    <span class="keyword">public</span> Xx <span class="title function_">getXxById</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="comment">// 省略实现</span></span><br><span class="line">        <span class="keyword">return</span> xx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateXx</span><span class="params">(Xx xx)</span> &#123;</span><br><span class="line">        <span class="comment">// 更新MySQL数据 省略</span></span><br><span class="line">        <span class="comment">// 删除缓存</span></span><br><span class="line">        xxLazyCache.deleteXxFromCache(xx.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteXx</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="comment">// 删除MySQL数据 省略</span></span><br><span class="line">        <span class="comment">// 删除缓存</span></span><br><span class="line">        xxLazyCache.deleteXxFromCache(xx.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Xx</span> &#123;</span><br><span class="line">    <span class="comment">// 业务主键</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;redis-Guava-缓存&quot;&gt;&lt;a href=&quot;#redis-Guava-缓存&quot; class=&quot;headerlink&quot; title=&quot;redis Guava 缓存&quot;&gt;&lt;/a&gt;redis Guava 缓存&lt;/h2&gt;&lt;h3 id=&quot;redis-懒加载&quot;&gt;&lt;a hre</summary>
      
    
    
    
    <category term="Guava" scheme="http://duanyushuai.github.io/categories/Guava/"/>
    
    <category term="redis" scheme="http://duanyushuai.github.io/categories/Guava/redis/"/>
    
    
    <category term="Guava" scheme="http://duanyushuai.github.io/tags/Guava/"/>
    
    <category term="redis" scheme="http://duanyushuai.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>解决跨域</title>
    <link href="http://duanyushuai.github.io/2022/06/25/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F/"/>
    <id>http://duanyushuai.github.io/2022/06/25/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F/</id>
    <published>2022-06-25T09:57:38.465Z</published>
    <updated>2022-08-14T04:28:49.153Z</updated>
    
    <content type="html"><![CDATA[<h2 id="解决跨域"><a href="#解决跨域" class="headerlink" title="解决跨域"></a>解决跨域</h2><ol><li>使用nginx部署为同一域</li></ol><p><img src="/../img/kuayu1.png" alt=" "></p><ol start="2"><li>请求返回可跨域</li></ol><p><img src="/../img/kuayu2.png">   </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;解决跨域&quot;&gt;&lt;a href=&quot;#解决跨域&quot; class=&quot;headerlink&quot; title=&quot;解决跨域&quot;&gt;&lt;/a&gt;解决跨域&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;使用nginx部署为同一域&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;/../img/kuayu1.png</summary>
      
    
    
    
    <category term="java web" scheme="http://duanyushuai.github.io/categories/java-web/"/>
    
    
    <category term="java web" scheme="http://duanyushuai.github.io/tags/java-web/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://duanyushuai.github.io/2022/06/12/Duan/"/>
    <id>http://duanyushuai.github.io/2022/06/12/Duan/</id>
    <published>2022-06-12T09:02:04.255Z</published>
    <updated>2022-06-13T00:32:33.427Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Duan"><a href="#Duan" class="headerlink" title="Duan"></a>Duan</h2><p>test</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Duan&quot;&gt;&lt;a href=&quot;#Duan&quot; class=&quot;headerlink&quot; title=&quot;Duan&quot;&gt;&lt;/a&gt;Duan&lt;/h2&gt;&lt;p&gt;test&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>api接口优化</title>
    <link href="http://duanyushuai.github.io/2022/06/07/api%E6%8E%A5%E5%8F%A3%E4%BC%98%E5%8C%96/"/>
    <id>http://duanyushuai.github.io/2022/06/07/api%E6%8E%A5%E5%8F%A3%E4%BC%98%E5%8C%96/</id>
    <published>2022-06-07T02:00:00.000Z</published>
    <updated>2022-08-14T04:29:34.848Z</updated>
    
    <content type="html"><![CDATA[<h1 id="api-接口调优"><a href="#api-接口调优" class="headerlink" title="api 接口调优"></a>api 接口调优</h1><h3 id="慢查询"><a href="#慢查询" class="headerlink" title="慢查询"></a>慢查询</h3><h4 id="1-深度分页"><a href="#1-深度分页" class="headerlink" title="1.深度分页"></a>1.深度分页</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name,code from student limit 1000,20</span><br></pre></td></tr></table></figure><p>会查出来前1000条数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name,code from student where id &gt; 1000 limit 20</span><br></pre></td></tr></table></figure><p>走索引，但需要上次查询出来的最大id</p><h4 id="2-未加索引"><a href="#2-未加索引" class="headerlink" title="2.未加索引"></a>2.未加索引</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create table xxxx (表名)</span><br></pre></td></tr></table></figure><p>查看表索引</p><p>加索引表可能引起锁表，要在mysql使用低峰期</p><h4 id="3-索引失效"><a href="#3-索引失效" class="headerlink" title="3.索引失效"></a>3.索引失效</h4><p><strong>索引失效的几个原因</strong></p><ol><li>索引字段的区分度不大</li><li>索引语句在or中</li><li>模糊匹配 %xxx</li><li>索引发生隐式变换</li><li>不满足最左前缀规则</li><li>where条件里，索引有计算</li></ol><h4 id="4-join-过多or子查询过多"><a href="#4-join-过多or子查询过多" class="headerlink" title="4.join 过多or子查询过多"></a>4.join 过多or子查询过多</h4><p>一般不建议用子查询，可以把子查询改成join，join的表也不宜过多，具体问题具体分析，看数据量</p><h4 id="5-in的元素过多"><a href="#5-in的元素过多" class="headerlink" title="5.in的元素过多"></a>5.in的元素过多</h4><p>如果一个查询有in ，in条件加了合适的索引，还是慢，就高度怀疑是in的元素过多。可以分组查询，再快可以引用多线程</p><p>in元素过多可以在代码层做限制</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(ids.size() &gt; <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;单次查询数据量太多&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-单纯数据量过大"><a href="#6-单纯数据量过大" class="headerlink" title="6.单纯数据量过大"></a>6.单纯数据量过大</h4><p>分库分表</p><h3 id="业务复杂"><a href="#业务复杂" class="headerlink" title="业务复杂"></a>业务复杂</h3><h4 id="1-循环调用"><a href="#1-循环调用" class="headerlink" title="1.循环调用"></a>1.循环调用</h4><p>循环调用同一段代码，每次的循环逻辑一致，前后不关联。比如我们要初始化一个列表。</p><p>可采用多线程的方式去获取数据</p><h4 id="2-顺序调用"><a href="#2-顺序调用" class="headerlink" title="2. 顺序调用"></a>2. 顺序调用</h4><p><img src="/../img/api%E8%B0%83%E4%BC%981.png"></p><p>使用CompletableFuture解决</p><h4 id="3-线程池设置不合理"><a href="#3-线程池设置不合理" class="headerlink" title="3. 线程池设置不合理"></a>3. 线程池设置不合理</h4><p>调整线程池参数，查看时候是io任务还是cpu任务，根据业务来拆分线程池。</p><h4 id="4-锁设置并不合理"><a href="#4-锁设置并不合理" class="headerlink" title="4. 锁设置并不合理"></a>4. 锁设置并不合理</h4><p>锁类型使用不合理，就是读写锁。锁粒度太大</p><h4 id="5-机器问题（fullGC，机器重启，线程打满）"><a href="#5-机器问题（fullGC，机器重启，线程打满）" class="headerlink" title="5.机器问题（fullGC，机器重启，线程打满）"></a>5.机器问题（fullGC，机器重启，线程打满）</h4><p>造成这个问题的原因非常多，笔者就遇到了定时任务过大引起fullGC，代码存在线程泄露引起RSS内存占用过高进而引起机器重启等待诸多原因。需要结合各种监控和具体场景具体分析，进而进行大事务拆分、重新规划线程池等等工作</p><h4 id="6-万金油解决方式"><a href="#6-万金油解决方式" class="headerlink" title="6. 万金油解决方式"></a>6. 万金油解决方式</h4><p> <strong>缓存</strong></p><ul><li>简单的map</li><li>guava等本地缓存工具包</li><li>缓存中间件：redis、tair或memcached</li></ul><p><strong>回调和反查</strong></p><p>​       这种方式往往是业务上的解决方式，在订单或者付款系统中应用的比较多。举个例子：当我们付款的时候，需要调用一个专门的付款系统接口，该系统经过一系列验证、存储工作后还要调用银行接口以执行付款。由于付款这个动作要求十分严谨，银行侧接口执行可能比较缓慢，进而拖累整个付款接口性能。</p><p>​       这个时候我们就可以采用fast success的方式：当必要的校验和存储完成后，立即返回success，同时告诉调用方一个中间态“付款中”。而后调用银行接口，当获得支付结果后再调用上游系统的回调接口返回付款的最终结果“成果”or“失败”。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;api-接口调优&quot;&gt;&lt;a href=&quot;#api-接口调优&quot; class=&quot;headerlink&quot; title=&quot;api 接口调优&quot;&gt;&lt;/a&gt;api 接口调优&lt;/h1&gt;&lt;h3 id=&quot;慢查询&quot;&gt;&lt;a href=&quot;#慢查询&quot; class=&quot;headerlink&quot; ti</summary>
      
    
    
    
    <category term="java web" scheme="http://duanyushuai.github.io/categories/java-web/"/>
    
    
    <category term="java web" scheme="http://duanyushuai.github.io/tags/java-web/"/>
    
  </entry>
  
  <entry>
    <title>docker入门</title>
    <link href="http://duanyushuai.github.io/2022/03/02/docker/"/>
    <id>http://duanyushuai.github.io/2022/03/02/docker/</id>
    <published>2022-03-02T02:00:00.000Z</published>
    <updated>2022-06-21T02:24:27.154Z</updated>
    
    <content type="html"><![CDATA[<h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1. 卸载系统之前的docker </span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br><span class="line">2.$ sudo yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br><span class="line"></span><br><span class="line">3. sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">4. 安装DOCKER引擎</span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line">5. 启动Docker.</span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line">6. 设置开机自启</span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line">7. 阿里云镜像加速器</span><br><span class="line">https://cr.console.aliyun.com/cn-wulanchabu/instances/mirrors</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="docker-使用"><a href="#docker-使用" class="headerlink" title="docker 使用"></a>docker 使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull mysql:8.0</span><br><span class="line"></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">创建目录保存数据</span><br><span class="line">sudo docker run --name mysql -v /usr/local/mysql/data:/var/lib/mysql -v /usr/local/mysql:/etc/mysql/conf.d -v /usr/local/mysql/log:/var/log/mysql  -e MYSQL_ROOT_PASSWORD=root  -p 3306:3306 -d mysql:8.0</span><br><span class="line"></span><br><span class="line"><span class="comment">## -v 目录映射，可以在linux环境中寻找文件，修改容器配置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看运行容器</span><br><span class="line">docker ps</span><br><span class="line">[root@hecs-328722 mysql]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                                                  NAMES</span><br><span class="line">369ccdfb7630   mysql:8.0   <span class="string">&quot;docker-entrypoint.s…&quot;</span>   6 minutes ago   Up 6 minutes   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   mysql</span><br><span class="line"></span><br><span class="line">进入容器 内部</span><br><span class="line">docker <span class="built_in">exec</span> -it 容器名称|容器<span class="built_in">id</span> bin/bash</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -it mysql bin/bash</span><br><span class="line"></span><br><span class="line">退出容器</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">1. 安装redis</span><br><span class="line">docker pull redis:6.0.10</span><br><span class="line"></span><br><span class="line">2. 修改需要自定义的配置(docker-redis默认没有配置文件，</span><br><span class="line">自己在宿主机建立后挂载映射)</span><br><span class="line">创建并修改/usr/local/redis/redis.conf</span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0 开启远程权限</span><br><span class="line">appendonly <span class="built_in">yes</span> 开启aof持久化</span><br><span class="line"></span><br><span class="line">3.</span><br><span class="line">docker run --name redis  -v /usr/local/redis/data:/data  -v /usr/local/redis/redis.conf:/usr/local/etc/redis/redis.conf -p 6379:6379 -d redis:6.0.10  redis-server /usr/local/etc/redis/redis.conf </span><br><span class="line"></span><br><span class="line">解释： -v /usr/local/redis/data:/data  <span class="comment"># 将数据目录挂在到本地保证数据安全</span></span><br><span class="line"> -v /root/redis/redis.conf:/usr/local/etc/redis/redis.conf   <span class="comment"># 将配置文件挂在到本地修改方便</span></span><br><span class="line"> </span><br><span class="line"> 4. docker 起客户端</span><br><span class="line"> docker <span class="built_in">exec</span> -it redis redis-cli</span><br><span class="line"></span><br><span class="line"> 5. 重启redis</span><br><span class="line"> docker restart redis</span><br><span class="line"> </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;docker&quot;&gt;&lt;a href=&quot;#docker&quot; class=&quot;headerlink&quot; title=&quot;docker&quot;&gt;&lt;/a&gt;docker&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutt</summary>
      
    
    
    
    <category term="docker" scheme="http://duanyushuai.github.io/categories/docker/"/>
    
    <category term="谷粒商城" scheme="http://duanyushuai.github.io/categories/docker/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/"/>
    
    
    <category term="docker" scheme="http://duanyushuai.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>rabbitMQ</title>
    <link href="http://duanyushuai.github.io/2022/02/20/rabbitMQ/"/>
    <id>http://duanyushuai.github.io/2022/02/20/rabbitMQ/</id>
    <published>2022-02-20T02:00:00.000Z</published>
    <updated>2022-08-11T14:11:58.877Z</updated>
    
    <content type="html"><![CDATA[<h1 id="rabbitMQ"><a href="#rabbitMQ" class="headerlink" title="rabbitMQ"></a>rabbitMQ</h1><p><img src="/../img/rabbitMQ1.jpeg" alt="image-20220729112858465"></p><p><img src="/../img/rabbitMQ3.png" alt="image-20220729113148829"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;rabbitMQ&quot;&gt;&lt;a href=&quot;#rabbitMQ&quot; class=&quot;headerlink&quot; title=&quot;rabbitMQ&quot;&gt;&lt;/a&gt;rabbitMQ&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/../img/rabbitMQ1.jpeg&quot; alt=&quot;image-2</summary>
      
    
    
    
    <category term="rabbitMQ" scheme="http://duanyushuai.github.io/categories/rabbitMQ/"/>
    
    
    <category term="rabbitMQ" scheme="http://duanyushuai.github.io/tags/rabbitMQ/"/>
    
  </entry>
  
  <entry>
    <title>全局异常</title>
    <link href="http://duanyushuai.github.io/2021/10/11/%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8/"/>
    <id>http://duanyushuai.github.io/2021/10/11/%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8/</id>
    <published>2021-10-11T02:00:00.000Z</published>
    <updated>2022-08-14T04:29:18.719Z</updated>
    
    <content type="html"><![CDATA[<h2 id="全局异常"><a href="#全局异常" class="headerlink" title="全局异常"></a>全局异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice(basePackages = &quot;com.yxj.gulimall.product.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GulimallExceptionControllerAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleValidException</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;数据校验出现问题&#123;&#125;,异常类型: &#123;&#125;&quot;</span>,e.getMessage(),e.getClass());</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> e.getBindingResult();</span><br><span class="line">        Map&lt;String, String&gt; errorMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        bindingResult.getFieldErrors().forEach((fieldError -&gt; &#123;</span><br><span class="line">            errorMap.put(fieldError.getField(),fieldError.getDefaultMessage());</span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.VALID_EXCEPTION.getCode(),BizCodeEnum.VALID_EXCEPTION.getMsg()).put(<span class="string">&quot;data&quot;</span>,errorMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Throwable.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleException</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;错误:&quot;</span>, throwable);</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.UNKNOWN_EXCEPTION.getCode(),BizCodeEnum.UNKNOWN_EXCEPTION.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;全局异常&quot;&gt;&lt;a href=&quot;#全局异常&quot; class=&quot;headerlink&quot; title=&quot;全局异常&quot;&gt;&lt;/a&gt;全局异常&lt;/h2&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>HashMap</title>
    <link href="http://duanyushuai.github.io/2021/07/08/HashMap/"/>
    <id>http://duanyushuai.github.io/2021/07/08/HashMap/</id>
    <published>2021-07-08T03:00:23.000Z</published>
    <updated>2022-06-18T07:38:31.348Z</updated>
    
    <content type="html"><![CDATA[<h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p>jdk1.7  数组+链表</p><p>jdk1.8 数组+ 链表&#x2F;红黑树</p><ul><li><code>DEFAULT_INITIAL_CAPACITY</code> Table数组的初始化长度： <code>1 &lt;&lt; 4``2^4=16</code>（为什么要是 2的n次方？）</li><li><code>MAXIMUM_CAPACITY</code> Table数组的最大长度： <code>1&lt;&lt;30``2^30=1073741824</code></li><li><code>DEFAULT_LOAD_FACTOR</code> 负载因子：默认值为<code>0.75</code>。 当元素的总个数&gt;当前数组的长度 * 负载因子。数组会进行扩容，扩容为原来的两倍（todo：为什么是两倍？）</li><li><code>TREEIFY_THRESHOLD</code> 链表树化阙值： 默认值为 <code>8</code> 。表示在一个node（Table）节点下的值的个数大于8时候，会将链表转换成为红黑树。</li><li><code>UNTREEIFY_THRESHOLD</code> 红黑树链化阙值： 默认值为 <code>6</code> 。 表示在进行扩容期间，单个Node节点下的红黑树节点的个数小于6时候，会将红黑树转化成为链表。</li><li><code>MIN_TREEIFY_CAPACITY = 64</code> 最小树化阈值，当Table所有元素超过改值，才会进行树化（为了防止前期阶段频繁扩容和树化过程冲突）</li></ul><p>HashMap是线程不安全的</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;HashMap&quot;&gt;&lt;a href=&quot;#HashMap&quot; class=&quot;headerlink&quot; title=&quot;HashMap&quot;&gt;&lt;/a&gt;HashMap&lt;/h2&gt;&lt;p&gt;jdk1.7  数组+链表&lt;/p&gt;
&lt;p&gt;jdk1.8 数组+ 链表&amp;#x2F;红黑树&lt;/p&gt;
&lt;u</summary>
      
    
    
    
    <category term="java" scheme="http://duanyushuai.github.io/categories/java/"/>
    
    
    <category term="java" scheme="http://duanyushuai.github.io/tags/java/"/>
    
    <category term="HashMap" scheme="http://duanyushuai.github.io/tags/HashMap/"/>
    
  </entry>
  
  <entry>
    <title>Java高并发程序设计第二章</title>
    <link href="http://duanyushuai.github.io/2021/06/07/Java%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E4%BA%8C%E7%AB%A0/"/>
    <id>http://duanyushuai.github.io/2021/06/07/Java%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E4%BA%8C%E7%AB%A0/</id>
    <published>2021-06-07T03:00:23.000Z</published>
    <updated>2022-06-13T15:00:55.975Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java高并发程序设计第二章"><a href="#Java高并发程序设计第二章" class="headerlink" title="Java高并发程序设计第二章"></a>Java高并发程序设计第二章</h1><h4 id="线程创建4个方法"><a href="#线程创建4个方法" class="headerlink" title="线程创建4个方法"></a>线程创建4个方法</h4><p>创建线程4个方法</p><ol><li>继承Thread类创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;<span class="comment">//继承Thread类</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">　　<span class="comment">//重写run方法</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">MyThread</span>().start();<span class="comment">//创建并启动线程</span></span><br></pre></td></tr></table></figure><ol start="2"><li>实现Runnable接口创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;<span class="comment">//实现Runnable接口</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">　　<span class="comment">//重写run方法</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">　　　　<span class="comment">//创建并启动线程</span></span><br><span class="line">　　　　MyThread2 myThread=<span class="keyword">new</span> <span class="title class_">MyThread2</span>();</span><br><span class="line">　　　　Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(myThread);</span><br><span class="line">　　　　thread().start();</span><br><span class="line"></span><br><span class="line">　　　　<span class="comment">//或者    new Thread(new MyThread2()).start();</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>使用Callable和Future创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">// 先使用Lambda表达式创建Callable&lt;Integer&gt;对象</span></span><br><span class="line">       <span class="comment">// 使用FutureTask来包装Callable对象</span></span><br><span class="line">       FutureTask&lt;Integer&gt; task = <span class="keyword">new</span>  <span class="title class_">FutureTask</span>&lt;&gt;((Callable&lt;Integer&gt;)() -&gt; <span class="number">5</span>);</span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">Thread</span>(task).start();</span><br><span class="line">       <span class="keyword">try</span></span><br><span class="line">       &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;子线程的返回值：&quot;</span> +  task.get());</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">       &#123;</span><br><span class="line">           ex.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>使用线程池例如用Executor框架</li></ol><h4 id="线程中断"><a href="#线程中断" class="headerlink" title="线程中断"></a>线程中断</h4><hr><p>禁止用stop()来退出线程，不安全。</p><p>线程安全退出，与中断有关的三个方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> Thread.interrupt() <span class="comment">// 中断线程</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> Thread.isInterrupted() <span class="comment">// 判断是否被中断</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> Thread.interrupted() <span class="comment">// 判断是否被中断，并清除当前中断状态</span></span><br></pre></td></tr></table></figure><h4 id="等待wait和通知notify"><a href="#等待wait和通知notify" class="headerlink" title="等待wait和通知notify"></a>等待wait和通知notify</h4><hr><p>这两个⽅法并不是在Thread类中 的，⽽是输出Object类。</p><p>Object.wait()和Thread.sleep()方法都可以让线程等待若干时 间。除了wait()可以被唤醒外，另外一个主要区别就是wait()方法会 释放目标对象的锁，而Thread.sleep()方法不会释放任何资源。</p><h4 id="等待线程结束（join-和谦让-yield"><a href="#等待线程结束（join-和谦让-yield" class="headerlink" title="等待线程结束（join)和谦让(yield)"></a>等待线程结束（join)和谦让(yield)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JoinMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AddThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">1111111</span>;i++);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span></span><br><span class="line">            InterruptedException &#123;</span><br><span class="line">        AddThread at=<span class="keyword">new</span> <span class="title class_">AddThread</span>();</span><br><span class="line">        at.start();</span><br><span class="line">        at.join();</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>join()d的核心代码段</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line"> wait(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>可以看到，它让调⽤线程在当前线程对象上进⾏等待。当线程执 ⾏完成后，被等待的线程会在退出前调⽤notifyAll()通知所有的等待线 程继续执⾏。因此，值得注意的⼀点是：不要在应⽤程序中，在 Thread对象实例上使⽤类似wait()或者notify()等⽅法，因为这很有可能 会影响系统API的⼯作，或者被系统API所影响。</p></blockquote></blockquote><h4 id="守护线程-Daemon"><a href="#守护线程-Daemon" class="headerlink" title="守护线程(Daemon)"></a>守护线程(Daemon)</h4><p>如垃圾回收线程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> testdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaemonDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(DaemonDemo.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DaemonT</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">                logger.info(<span class="string">&quot;I am alive&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DaemonT</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DaemonT</span>();</span><br><span class="line">        d.setDaemon(<span class="literal">true</span>);</span><br><span class="line">        d.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>d线程为main线程的守护线程，main一结束，d立即结束。</p><h4 id="线程优先级设置"><a href="#线程优先级设置" class="headerlink" title="线程优先级设置"></a>线程优先级设置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread high=<span class="keyword">new</span> <span class="title class_">HightPriority</span>();</span><br><span class="line">LowPriority low=<span class="keyword">new</span> <span class="title class_">LowPriority</span>();</span><br><span class="line">high.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">low.setPriority(Thread.MIN_PRIORITY);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Java高并发程序设计第二章&quot;&gt;&lt;a href=&quot;#Java高并发程序设计第二章&quot; class=&quot;headerlink&quot; title=&quot;Java高并发程序设计第二章&quot;&gt;&lt;/a&gt;Java高并发程序设计第二章&lt;/h1&gt;&lt;h4 id=&quot;线程创建4个方法&quot;&gt;&lt;a href</summary>
      
    
    
    
    <category term="java" scheme="http://duanyushuai.github.io/categories/java/"/>
    
    
    <category term="java" scheme="http://duanyushuai.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>joda-time、日志、代码规范</title>
    <link href="http://duanyushuai.github.io/2021/04/07/joda-time%20%20%E6%97%A5%E5%BF%97%20%20%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/"/>
    <id>http://duanyushuai.github.io/2021/04/07/joda-time%20%20%E6%97%A5%E5%BF%97%20%20%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/</id>
    <published>2021-04-07T03:00:23.000Z</published>
    <updated>2022-06-13T15:02:06.174Z</updated>
    
    <content type="html"><![CDATA[<h4 id="joda-time-日志-代码规范"><a href="#joda-time-日志-代码规范" class="headerlink" title="joda-time  日志  代码规范"></a>joda-time  日志  代码规范</h4><h5 id="jode-time"><a href="#jode-time" class="headerlink" title="jode-time"></a>jode-time</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dateDemo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">dt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>(<span class="number">2015</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">12</span>,<span class="number">30</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">d</span> <span class="operator">=</span> dt.toDate();</span><br><span class="line">        <span class="comment">//当天起始日期</span></span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">today</span> <span class="operator">=</span> DateTime.now().withTimeAtStartOfDay();</span><br><span class="line">        <span class="comment">//三天后的日期</span></span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">dateTime</span> <span class="operator">=</span> today.plusDays(<span class="number">3</span>).plusMonths(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//入住时间和离店时间的差值</span></span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">checkIn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>(<span class="number">2015</span>,<span class="number">8</span>,<span class="number">29</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">checkOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>(<span class="number">2015</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        System.out.println(Days.daysBetween(checkIn,checkOut).getDays());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>日期格式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateTimeExample1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">DATE_TIME_FORMATTER</span> <span class="operator">=</span> DateTimeFormat.forPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(DATE_TIME_FORMATTER.print(<span class="keyword">new</span> <span class="title class_">DateTime</span>()));</span><br><span class="line">        System.out.println(DATE_TIME_FORMATTER.parseDateTime(<span class="string">&quot;2000-01-01 12:12:12&quot;</span>).toDate());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="日志规范"><a href="#日志规范" class="headerlink" title="日志规范"></a>日志规范</h5><p>配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.7</span><span class="number">.25</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.1</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.1</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>实例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LogTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;log in trace level,args:&#123;&#125;&quot;</span>,args);</span><br><span class="line">        logger.debug(<span class="string">&quot;log in trace level,args:&#123;&#125;&quot;</span>,args);</span><br><span class="line">        logger.info(<span class="string">&quot;log in trace level,args:&#123;&#125;&quot;</span>,args);</span><br><span class="line">        logger.warn(<span class="string">&quot;log in trace level,args:&#123;&#125;&quot;</span>,args);</span><br><span class="line">        logger.error(<span class="string">&quot;log in trace level,args:&#123;&#125;&quot;</span>,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>查看日志</strong></p><ol><li>登录跳板机</li><li>在跳板机登录服务器</li><li>进入应用目录，一般为&#x2F;home&#x2F;q&#x2F;www&#x2F;&lt;应用名&gt;&#x2F;</li><li>该目录下有logs目录，其中存放了Tomcat日志，catalina.out记录了打印到控制台的日志，一般来说，查看改日志即可。</li></ol><p><strong>日志规范</strong></p><ul><li><p>禁止使用System.out.print()</p></li><li><p>在异常处理中打印关键信息</p><ul><li>入参</li><li>关键变量值</li></ul></li><li><p>注意数据保密</p><ul><li>与用户相关的信息保密</li><li>打码到日志</li></ul></li><li><p>不能影响正常业务</p><ul><li>打印日志不能抛出异常，不能影响正常业务</li><li>日志影响性能，高QPS业务，控制日志输出量。</li></ul></li><li><p>使用占位符代替字符串拼接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LogTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;111&quot;</span>;</span><br><span class="line">        logger.info(<span class="string">&quot;log in trace level,args: &#123;&#125;&quot;</span>,args);</span><br><span class="line">        logger.info(<span class="string">&quot;log in trace level,args: &#123;&#125; , &#123;&#125;&quot;</span>,s,s.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>代码规范</strong></p><ul><li>代码给以后的自己看</li><li>强迫症</li></ul><p>书《编写可读代码的艺术》</p><ul><li>类名：形容词或动词</li><li>方法名：动词</li></ul><p><strong>注释</strong></p><ul><li>使用Javadoc格式编写注释</li><li>接口必须有注释，对参数，返回值有说明。例如参数限制，返回值是否为空，接口调用频率。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;joda-time-日志-代码规范&quot;&gt;&lt;a href=&quot;#joda-time-日志-代码规范&quot; class=&quot;headerlink&quot; title=&quot;joda-time  日志  代码规范&quot;&gt;&lt;/a&gt;joda-time  日志  代码规范&lt;/h4&gt;&lt;h5 id=&quot;j</summary>
      
    
    
    
    <category term="java" scheme="http://duanyushuai.github.io/categories/java/"/>
    
    
    <category term="java" scheme="http://duanyushuai.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>线程创建4个方法</title>
    <link href="http://duanyushuai.github.io/2021/04/07/%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA4%E4%B8%AA%E6%96%B9%E6%B3%95/"/>
    <id>http://duanyushuai.github.io/2021/04/07/%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA4%E4%B8%AA%E6%96%B9%E6%B3%95/</id>
    <published>2021-04-07T03:00:23.000Z</published>
    <updated>2022-06-13T15:00:03.170Z</updated>
    
    <content type="html"><![CDATA[<h4 id="线程创建4个方法"><a href="#线程创建4个方法" class="headerlink" title="线程创建4个方法"></a>线程创建4个方法</h4><p>创建线程4个方法</p><ol><li>继承Thread类创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;<span class="comment">//继承Thread类</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">　　<span class="comment">//重写run方法</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">MyThread</span>().start();<span class="comment">//创建并启动线程</span></span><br></pre></td></tr></table></figure><ol start="2"><li>实现Runnable接口创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;<span class="comment">//实现Runnable接口</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">　　<span class="comment">//重写run方法</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">　　<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">　　　　<span class="comment">//创建并启动线程</span></span><br><span class="line">　　　　MyThread2 myThread=<span class="keyword">new</span> <span class="title class_">MyThread2</span>();</span><br><span class="line">　　　　Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(myThread);</span><br><span class="line">　　　　thread().start();</span><br><span class="line"></span><br><span class="line">　　　　<span class="comment">//或者    new Thread(new MyThread2()).start();</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>使用Callable和Future创建线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">// 先使用Lambda表达式创建Callable&lt;Integer&gt;对象</span></span><br><span class="line">       <span class="comment">// 使用FutureTask来包装Callable对象</span></span><br><span class="line">       FutureTask&lt;Integer&gt; task = <span class="keyword">new</span>  <span class="title class_">FutureTask</span>&lt;&gt;((Callable&lt;Integer&gt;)() -&gt; <span class="number">5</span>);</span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">Thread</span>(task).start();</span><br><span class="line">       <span class="keyword">try</span></span><br><span class="line">       &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;子线程的返回值：&quot;</span> +  task.get());</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">       &#123;</span><br><span class="line">           ex.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>使用线程池例如用Executor框架</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;线程创建4个方法&quot;&gt;&lt;a href=&quot;#线程创建4个方法&quot; class=&quot;headerlink&quot; title=&quot;线程创建4个方法&quot;&gt;&lt;/a&gt;线程创建4个方法&lt;/h4&gt;&lt;p&gt;创建线程4个方法&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;继承Thread类创建线程&lt;/li&gt;
&lt;/ol&gt;</summary>
      
    
    
    
    <category term="java" scheme="http://duanyushuai.github.io/categories/java/"/>
    
    
    <category term="java" scheme="http://duanyushuai.github.io/tags/java/"/>
    
  </entry>
  
</feed>
